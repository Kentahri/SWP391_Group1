@startuml table-reservation-state-diagram
title State Transitions: Table Status & Reservation Status

!define SUCCESS #90EE90
!define WARNING #FFD700
!define DANGER #FF6B6B
!define INFO #87CEEB

left to right direction

package "Table State Machine" {
    state "AVAILABLE" as TableAvailable SUCCESS
    state "RESERVED" as TableReserved WARNING
    state "OCCUPIED" as TableOccupied DANGER
    state "WAITING_PAYMENT" as TableWaitingPayment INFO
    
    [*] --> TableAvailable : Bàn mới tạo
    
    TableAvailable --> TableReserved : **createReservation()**\n✅ Tạo đặt bàn\n📅 Schedule NO_SHOW check
    
    TableReserved --> TableOccupied : **🔓 OPEN TABLE**\n(Cashier click nút)\nReservation: CONFIRMED → ARRIVED\n❌ Cancel NO_SHOW task
    
    TableReserved --> TableAvailable : **cancelReservation()**\nhoặc **Auto NO_SHOW**\n(sau 15 phút không đến)\n✅ NO_SHOW task executed
    
    TableAvailable --> TableOccupied : Guest walk-in\n(không có reservation)
    
    TableOccupied --> TableWaitingPayment : Guest request payment
    
    TableWaitingPayment --> TableAvailable : Payment completed
    
    note top of TableReserved
        **Trong trạng thái RESERVED:**
        - Có scheduled task tự động
        - Sẽ tự động mở bàn (AVAILABLE)
          nếu khách không đến sau 15 phút
    end note
    
    note right of TableOccupied
        **Khi OPEN TABLE:**
        - Reservation status: ARRIVED
        - Table status: OCCUPIED
        - NO_SHOW task: CANCELED
    end note
}

package "Reservation State Machine" {
    state "CONFIRMED" as ResConfirmed SUCCESS
    state "ARRIVED" as ResArrived INFO
    state "CANCELED" as ResCanceled DANGER
    state "NO_SHOW" as ResNoShow WARNING
    
    [*] --> ResConfirmed : **createReservation()**\n📅 Schedule task @(startTime + 15m)
    
    ResConfirmed --> ResArrived : **🔓 openTable()**\n(Cashier action)\n❌ Cancel scheduled task
    
    ResConfirmed --> ResCanceled : **cancelReservation()**\n(Cashier/Customer)\n❌ Cancel scheduled task
    
    ResConfirmed --> ResNoShow : **⏰ Auto after 15 min**\n(Scheduled task executed)\n✅ Task completed
    
    note top of ResConfirmed
        **Scheduled Task Active:**
        Task sẽ tự động chạy vào:
        startTime + 15 phút
    end note
    
    note bottom of ResArrived
        **Khách đã đến**
        Task đã bị cancel
    end note
    
    note bottom of ResCanceled
        **Đặt bàn bị hủy**
        Task đã bị cancel
    end note
    
    note bottom of ResNoShow
        **Khách không đến**
        Task đã chạy xong
    end note
}

@enduml



