@startuml table-reservation-state-diagram
title State Transitions: Table Status & Reservation Status

!define SUCCESS #90EE90
!define WARNING #FFD700
!define DANGER #FF6B6B
!define INFO #87CEEB

left to right direction

package "Table State Machine" {
    state "AVAILABLE" as TableAvailable SUCCESS
    state "RESERVED" as TableReserved WARNING
    state "OCCUPIED" as TableOccupied DANGER
    state "WAITING_PAYMENT" as TableWaitingPayment INFO
    
    [*] --> TableAvailable : BÃ n má»›i táº¡o
    
    TableAvailable --> TableReserved : **createReservation()**\nâœ… Táº¡o Ä‘áº·t bÃ n\nğŸ“… Schedule NO_SHOW check
    
    TableReserved --> TableOccupied : **ğŸ”“ OPEN TABLE**\n(Cashier click nÃºt)\nReservation: CONFIRMED â†’ ARRIVED\nâŒ Cancel NO_SHOW task
    
    TableReserved --> TableAvailable : **cancelReservation()**\nhoáº·c **Auto NO_SHOW**\n(sau 15 phÃºt khÃ´ng Ä‘áº¿n)\nâœ… NO_SHOW task executed
    
    TableAvailable --> TableOccupied : Guest walk-in\n(khÃ´ng cÃ³ reservation)
    
    TableOccupied --> TableWaitingPayment : Guest request payment
    
    TableWaitingPayment --> TableAvailable : Payment completed
    
    note top of TableReserved
        **Trong tráº¡ng thÃ¡i RESERVED:**
        - CÃ³ scheduled task tá»± Ä‘á»™ng
        - Sáº½ tá»± Ä‘á»™ng má»Ÿ bÃ n (AVAILABLE)
          náº¿u khÃ¡ch khÃ´ng Ä‘áº¿n sau 15 phÃºt
    end note
    
    note right of TableOccupied
        **Khi OPEN TABLE:**
        - Reservation status: ARRIVED
        - Table status: OCCUPIED
        - NO_SHOW task: CANCELED
    end note
}

package "Reservation State Machine" {
    state "CONFIRMED" as ResConfirmed SUCCESS
    state "ARRIVED" as ResArrived INFO
    state "CANCELED" as ResCanceled DANGER
    state "NO_SHOW" as ResNoShow WARNING
    
    [*] --> ResConfirmed : **createReservation()**\nğŸ“… Schedule task @(startTime + 15m)
    
    ResConfirmed --> ResArrived : **ğŸ”“ openTable()**\n(Cashier action)\nâŒ Cancel scheduled task
    
    ResConfirmed --> ResCanceled : **cancelReservation()**\n(Cashier/Customer)\nâŒ Cancel scheduled task
    
    ResConfirmed --> ResNoShow : **â° Auto after 15 min**\n(Scheduled task executed)\nâœ… Task completed
    
    note top of ResConfirmed
        **Scheduled Task Active:**
        Task sáº½ tá»± Ä‘á»™ng cháº¡y vÃ o:
        startTime + 15 phÃºt
    end note
    
    note bottom of ResArrived
        **KhÃ¡ch Ä‘Ã£ Ä‘áº¿n**
        Task Ä‘Ã£ bá»‹ cancel
    end note
    
    note bottom of ResCanceled
        **Äáº·t bÃ n bá»‹ há»§y**
        Task Ä‘Ã£ bá»‹ cancel
    end note
    
    note bottom of ResNoShow
        **KhÃ¡ch khÃ´ng Ä‘áº¿n**
        Task Ä‘Ã£ cháº¡y xong
    end note
}

@enduml



