<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>Cashier Dashboard - Table Management</title>
	<link rel="stylesheet" th:href="@{/css/cashier-dashboard.css}"/>
	<style>
        .order-status.preparing {
            background: #fff3cd;
            color: #856404;
        }

        .order-status.served {
            background: #d1ecf1;
            color: #0c5460;
        }

        .order-status.completed {
            background: #d4edda;
            color: #155724;
        }

        .payment-status.paid {
            background: #d4edda;
            color: #155724;
        }

        .payment-status.unpaid {
            background: #f8d7da;
            color: #721c24;
        }

        .payment-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .order-status.cancelled {
            background: #f8d7da;
            color: #721c24;
        }
	</style>
</head>
<body>
<div class="dashboard-container">
	<!-- Top bar -->
	<header class="topbar">
		<div class="brand">ğŸ• PizzarIO</div>
		<div class="staff-info">
			<span>TÃªn: <strong th:text="${staff.name}"></strong></span>
		</div>
		<div class="datetime-info">
			<div id="clock" class="clock">--:--:--</div>
			<div id="date" class="date">--/--/----</div>
		</div>
		<div class="actions">
			<!-- Notification Bell -->
			<button class="btn btn-notification" type="button" onclick="openNotificationModal()">
				<span class="notification-icon">ğŸ””</span>
				<span class="notification-badge" id="notification-badge" style="display: none;">0</span>
			</button>
			
			<button class="btn btn-secondary">
				<a
						th:href="@{/cashier/reservations/upcoming}"
						style="text-decoration: none"
				>ğŸ“… BÃ n Ä‘Ã£ Ä‘áº·t trÆ°á»›c</a
				>
			</button>
			<a
					class="btn btn-primary"
					th:href="@{/cashier/takeaway}"
					style="text-decoration: none; display: inline-block"
					target="_blank"
			>â• Táº¡o Ä‘Æ¡n hÃ ng</a
			>
			<button class="btn btn-secondary" type="button">
				<a th:href="@{/cashier/history}" style="text-decoration: none"
				>ğŸ“‹ Lá»‹ch sá»­</a
				>
			</button>
			<form th:action="@{/logout}" method="post">
				<input
						type="hidden"
						th:if="${_csrf != null}"
						th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}"
				/>
				<button
						type="submit"
						class="btn-logout"
						onclick="return confirmLogout()"
				>
					ğŸšª ÄÄƒng xuáº¥t
				</button>
			</form>
		</div>
	</header>
	
	<div class="layout">
		<!-- Left: Table Management -->
		<section class="panel left" id="left-panel">
			<div class="section-title">Quáº£n lÃ½ bÃ n</div>
			
			<!-- Legend -->
			<div class="legend">
				<div class="legend-items">
					<div class="legend-item">
						<span class="legend-dot available"></span>
						<span>BÃ n Ä‘ang trá»‘ng</span>
					</div>
					<div class="legend-item">
						<span class="legend-dot occupied"></span>
						<span>BÃ n Ä‘ang cÃ³ khÃ¡ch</span>
					</div>
					<div class="legend-item">
						<span class="legend-dot paid"></span>
						<span>BÃ n Ä‘ang chá» thanh toÃ¡n</span>
					</div>
					<div class="legend-item">
						<span class="legend-dot reserved"></span>
						<span>BÃ n Ä‘Ã£ Ä‘Æ°á»£c Ä‘áº·t trÆ°á»›c</span>
					</div>
					<div class="legend-item">
						<span class="legend-dot locked"></span>
						<span>BÃ n bá»‹ khÃ³a (gá»™p bÃ n)</span>
					</div>
				</div>
			</div>
			
			<!-- Table Grid -->
			<div class="table-grid" id="table-grid">
				<a
						th:each="table : ${tables}"
						th:id="'table-' + ${table.id}"
						th:class="'table-card ' + ${table.tableStatus.toString().toLowerCase()} + ${selectedTableId != null && selectedTableId == table.id ? ' selected' : ''}"
						th:href="@{/cashier/tables/{id}/order(id=${table.id})}"
						th:attr="data-id=${table.id},
				            data-status=${table.tableStatus},
				            data-capacity=${table.capacity}"
						style="text-decoration: none; color: inherit; cursor: pointer"
				>
					<div class="table-icon">
						<span th:if="${table.tableStatus == 'AVAILABLE'}">ğŸª‘</span>
						<span th:if="${table.tableStatus == 'OCCUPIED'}">ğŸ‘¥</span>
						<span th:if="${table.tableStatus == 'WAITING_PAYMENT'}"
						>âœ…</span
						>
						<span th:if="${table.tableStatus == 'RESERVED'}">ğŸ•</span>
						<span th:if="${table.tableStatus == 'LOCKED'}">ğŸ”’</span>
					</div>
					<div class="table-number">BÃ n [[${table.id}]]</div>
					<div class="table-info">
						<!-- Hiá»ƒn thá»‹ sá»‘ ngÆ°á»i -->
						<div
								class="party-size"
								th:if="${table.tableStatus != 'AVAILABLE'}"
						>
							Sá»‘ ngÆ°á»i tá»‘i Ä‘a:
							<span
									th:text="${table.capacity != null ? table.capacity : 'N/A'}"
							>N/A</span
							>
						</div>
						
						<!-- Hiá»ƒn thá»‹ tráº¡ng thÃ¡i -->
						<div class="table-status-text">
                  <span th:if="${table.tableStatus == 'AVAILABLE'}"
                  >Available</span
                  >
							<span th:if="${table.tableStatus == 'OCCUPIED'}"
							>Occupied</span
							>
							<span th:if="${table.tableStatus == 'WAITING_PAYMENT'}"
							>Paid</span
							>
							<span th:if="${table.tableStatus == 'RESERVED'}"
							>Reserved</span
							>
							<span th:if="${table.tableStatus == 'LOCKED'}"
							>Locked</span
							>
						</div>
						
						<!-- Hiá»ƒn thá»‹ thÃ´ng tin bá»• sung -->
						<div
								class="table-extra-info"
								th:if="${table.tableStatus == 'WAITING_PAYMENT'}"
						>
							<span>Payment</span>
						</div>
						<div
								class="table-extra-info"
								th:if="${table.tableStatus == 'RESERVED'}"
						>
							<span>Reserved</span>
						</div>
						<div
								class="table-extra-info"
								th:if="${table.tableStatus == 'LOCKED'}"
						>
							<span>Merged</span>
						</div>
					</div>
				</a>
			</div>
		</section>
		
		<!-- Resizable Divider -->
		<div class="resize-handle" id="resize-handle"></div>
		
		<!-- Right: Table details -->
		<section class="panel right" id="right-panel">
			<div
					class="section-title"
					id="right-panel-title"
					th:if="${showHistory == null || !showHistory}"
			>
            <span
		            th:text="${upcomingReservations != null ? 'Danh sÃ¡ch Ä‘áº·t bÃ n sáº¯p tá»›i' : (tableReservations != null ? 'ÄÆ¡n Ä‘áº·t trÆ°á»›c - BÃ n ' + selectedTableId : 'ÄÆ¡n bÃ n chi tiáº¿t')}"
            >ÄÆ¡n bÃ n chi tiáº¿t</span
            >
			</div>
			
			<!-- Table Detail View (default - no table selected) -->
			<div
					id="table-detail"
					class="table-detail"
					th:if="${orderDetail == null && selectedTableId == null && upcomingReservations == null && tableReservations == null && (showHistory == null || !showHistory)}"
			>
				<div class="placeholder">Chá»n 1 bÃ n Ä‘á»ƒ xem chi tiáº¿t</div>
			</div>
			
			<!-- Empty Table View (table selected but no order) -->
			<div
					th:if="${selectedTableId != null && orderDetail == null && upcomingReservations == null && tableReservations == null && (showHistory == null || !showHistory)}"
					class="table-detail"
			>
				<div class="detail-card">
					<!-- ThÃ´ng tin bÃ n -->
					<div class="detail-row">
						<strong>BÃ n sá»‘:</strong>
						<span th:text="${selectedTableId}">â€”</span>
					</div>
					<div class="detail-row">
						<strong>Sá»©c chá»©a:</strong>
						<span><span th:text="${tableCapacity}">â€”</span> ngÆ°á»i</span>
					</div>
					<div class="detail-row">
						<strong>Tráº¡ng thÃ¡i:</strong>
						<span
								th:text="${tableStatus.toString() == 'AVAILABLE' ? 'BÃ n Ä‘ang trá»‘ng' :
                            (tableStatus.toString() == 'OCCUPIED' ? 'BÃ n cÃ³ khÃ¡ch' :
                            (tableStatus.toString() == 'RESERVED' ? 'ÄÃ£ Ä‘áº·t trÆ°á»›c' :
                            (tableStatus.toString() == 'WAITING_PAYMENT' ? 'Chá» thanh toÃ¡n' :
                            (tableStatus.toString() == 'LOCKED' ? 'Äang khÃ³a' : 'â€”'))))}"
								th:style="${tableStatus.toString() == 'AVAILABLE' ? 'color: #28a745; font-weight: 600;' :
                             (tableStatus.toString() == 'OCCUPIED' ? 'color: #dc3545; font-weight: 600;' :
                             (tableStatus.toString() == 'RESERVED' ? 'color: #ffc107; font-weight: 600;' :
                             (tableStatus.toString() == 'WAITING_PAYMENT' ? 'color: #17a2b8; font-weight: 600;' :
                             (tableStatus.toString() == 'LOCKED' ? 'color: #795548; font-weight: 600;' : ''))))}"
						>â€”</span>
					</div>
					
					<!-- NÃºt actions á»Ÿ dÆ°á»›i -->
					<div class="table-actions">
						<!-- NÃºt má»Ÿ khÃ³a bÃ n (chá»‰ hiá»ƒn thá»‹ khi bÃ n LOCKED) -->
						<form
								th:if="${tableStatus != null && tableStatus.toString() == 'LOCKED'}"
								th:action="@{/cashier/tables/{tableId}/unlock(tableId=${selectedTableId})}"
								method="post"
								onsubmit="return confirm('XÃ¡c nháº­n má»Ÿ khÃ³a bÃ n nÃ y?');"
						>
							<input
									type="hidden"
									th:name="${_csrf.parameterName}"
									th:value="${_csrf.token}"
							/>
							<button
									type="submit"
									class="btn-action btn-unlock"
							>
								ğŸ”“ Má»Ÿ khÃ³a bÃ n
							</button>
						</form>
						
						<!-- CÃ¡c nÃºt khÃ¡c (chá»‰ hiá»ƒn thá»‹ khi bÃ n KHÃ”NG LOCKED) -->
						<div
								th:if="${tableStatus == null || tableStatus.toString() != 'LOCKED'}"
								class="action-buttons-group"
						>
							<button
									class="btn-action btn-reserve"
									th:onclick="'openReservationModal(' + ${selectedTableId} + ')'"
							>
								ğŸ“… Äáº·t trÆ°á»›c bÃ n nÃ y
							</button>
							<a
									th:href="@{/cashier/tables/{tableId}/reservations(tableId=${selectedTableId})}"
									class="btn-action btn-view-reservations"
							>
								ğŸ“‹ Xem Ä‘Æ¡n Ä‘áº·t trÆ°á»›c
							</a>
							
							<form
									th:if="${tableStatus != null && tableStatus.toString() == 'AVAILABLE'}"
									th:action="@{/cashier/tables/{tableId}/lock(tableId=${selectedTableId})}"
									method="post"
									onsubmit="return confirm('XÃ¡c nháº­n khÃ³a bÃ n nÃ y Ä‘á»ƒ gá»™p bÃ n?');"
							>
								<input
										type="hidden"
										th:name="${_csrf.parameterName}"
										th:value="${_csrf.token}"
								/>
								<button
										type="submit"
										class="btn-action btn-lock"
								>
									ğŸ”’ KhÃ³a bÃ n
								</button>
							</form>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Order Detail View (when table is selected and has order) -->
			<div
					th:if="${orderDetail != null && (showHistory == null || !showHistory)}"
					class="table-detail"
			>
				<div class="detail-card">
					<!-- ThÃ´ng tin bÃ n -->
					<div class="detail-row">
						<strong>BÃ n sá»‘:</strong>
						<span th:text="${selectedTableId}">â€”</span>
					</div>
					<div class="detail-row">
						<strong>Sá»©c chá»©a:</strong>
						<span><span th:text="${tableCapacity}">â€”</span> ngÆ°á»i</span>
					</div>
					<div class="detail-row">
						<strong>Tráº¡ng thÃ¡i:</strong>
						<span
								th:text="${tableStatus.toString() == 'AVAILABLE' ? 'BÃ n Ä‘ang trá»‘ng' :
                            (tableStatus.toString() == 'OCCUPIED' ? 'BÃ n cÃ³ khÃ¡ch' :
                            (tableStatus.toString() == 'RESERVED' ? 'ÄÃ£ Ä‘áº·t trÆ°á»›c' :
                            (tableStatus.toString() == 'WAITING_PAYMENT' ? 'Chá» thanh toÃ¡n' :
                            (tableStatus.toString() == 'LOCKED' ? 'Äang khÃ³a' : 'â€”'))))}"
								th:style="${tableStatus.toString() == 'AVAILABLE' ? 'color: #28a745; font-weight: 600;' :
                             (tableStatus.toString() == 'OCCUPIED' ? 'color: #dc3545; font-weight: 600;' :
                             (tableStatus.toString() == 'RESERVED' ? 'color: #ffc107; font-weight: 600;' :
                             (tableStatus.toString() == 'WAITING_PAYMENT' ? 'color: #17a2b8; font-weight: 600;' :
                             (tableStatus.toString() == 'LOCKED' ? 'color: #795548; font-weight: 600;' : ''))))}"
						>â€”</span>
					</div>
				</div>
				<div class="order-detail-card">
					<div class="order-header">
                <span
		                th:class="'order-status ' + ${orderDetail.orderStatus.toString().toLowerCase()}"
		                th:text="${orderDetail.orderStatus == 'PREPARING' ? 'Äang chuáº©n bá»‹' : (orderDetail.orderStatus == 'COMPLETED' ? 'HoÃ n thÃ nh' : orderDetail.orderStatus)}"
                >
                </span>
						<button
								th:if="${orderDetail != null && tableStatus.toString() == 'OCCUPIED'}"
								class="btn-edit-order"
								onclick="openEditOrderPanel()"
								type="button">
							âœï¸ ThÃªm mÃ³n
						</button>
					</div>
					
					<div class="order-meta">
						<div class="meta-row">
							<span class="meta-label">MÃ£ Ä‘Æ¡n:</span>
							<span class="meta-value"
							>#<span th:text="${orderDetail.orderId}">â€”</span></span
							>
						</div>
						<div class="meta-row">
							<span class="meta-label">KhÃ¡ch hÃ ng:</span>
							<span
									class="meta-value"
									th:text="${orderDetail.customerName ?: 'KhÃ¡ch vÃ£ng lai'}"
							>â€”</span
							>
						</div>
						<div class="meta-row">
							<span class="meta-label">Tráº¡ng thÃ¡i thanh toÃ¡n:</span>
							<span
									th:class="'meta-value payment-' + ${orderDetail.paymentStatus.toString().toLowerCase()}"
									th:text="${orderDetail.paymentStatus.toString() == 'UNPAID' ? 'ChÆ°a thanh toÃ¡n' : (orderDetail.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : 'Äang xá»­ lÃ½')}"
							>
                  </span>
						</div>
						<div
								class="meta-row"
								th:if="${orderDetail.paymentMethod != null}"
						>
							<span class="meta-label">PhÆ°Æ¡ng thá»©c:</span>
							<span
									class="meta-value"
									th:text="${orderDetail.paymentMethod.toString() == 'CASH' ? 'Tiá»n máº·t' : (orderDetail.paymentMethod.toString() == 'QR_BANKING' ? 'QR Code' : 'Tháº» tÃ­n dá»¥ng')}"
							></span>
						</div>
					</div>
					
					<div class="order-items-section">
						<div class="section-header-small">
							<span>MÃ³n Ä‘Ã£ gá»i</span>
							<span
									class="item-count"
									th:text="${#lists.isEmpty(orderDetail.items) ? '0 mÃ³n' : #lists.size(orderDetail.items) + ' mÃ³n'}"
							>0 mÃ³n</span
							>
						</div>
						<div class="order-items-list">
							<div
									th:if="${#lists.isEmpty(orderDetail.items)}"
									class="no-items"
							>
								ChÆ°a cÃ³ mÃ³n nÃ o
							</div>
							<div th:each="item : ${orderDetail.items}" class="order-item">
								<div class="order-item-info">
									<div class="item-name" 
										th:text="${item.sizeName != null && !#strings.isEmpty(item.sizeName) ? item.productName + ' (' + item.sizeName + ')' : item.productName}">
										â€”
									</div>
									<div class="item-detail">
                        <span class="item-quantity"
                        >x<span th:text="${item.quantity}">1</span></span
                        >
										<span class="item-price">
                          <span th:if="${item.productSize != null && item.productSize.onFlashSale}"
                                style="text-decoration: line-through; color: #999; font-size: 11px; margin-right: 6px;"
                                th:text="${#numbers.formatCurrency(item.productSize.basePrice)}">
                          </span>
                          <span th:text="${#numbers.formatCurrency(item.unitPrice)}"
                                th:style="${item.productSize != null && item.productSize.onFlashSale ? 'color: #e74c3c; font-weight: 600;' : ''}">0Ä‘</span>
                        </span>
									</div>
									<div
											th:if="${item.note != null && !#strings.isEmpty(item.note)}"
											class="item-note"
									>
										ğŸ“ <span th:text="${item.note}"></span>
									</div>
								</div>
								<div class="item-total">
                      <span th:text="${#numbers.formatCurrency(item.totalPrice)}"
                            th:style="${item.productSize != null && item.productSize.onFlashSale ? 'color: #e74c3c; font-weight: 600;' : ''}">0Ä‘</span>
								</div>
							</div>
						</div>
					</div>
					
					<div class="order-summary">
						<div
								th:if="${orderDetail.voucherCode != null}"
								class="summary-row"
								style="background: #fff3cd; padding: 8px; border-radius: 4px; margin-bottom: 8px;"
						>
							<span style="font-weight: 600;">Voucher:</span>
							<span
									class="voucher-code"
									th:text="${orderDetail.voucherCode}"
									style="color: #856404; font-weight: 600;"
							>â€”</span
							>
						</div>
						<div class="summary-row">
							<span>Táº¡m tÃ­nh:</span>
							<span
									th:text="${#numbers.formatCurrency(orderDetail.totalPrice)}"
							>0Ä‘</span
							>
						</div>
						<div
								th:if="${orderDetail.discountAmount != null && orderDetail.discountAmount > 0}"
								class="summary-row discount"
						>
							<span>Giáº£m giÃ¡:</span>
							<span
									th:text="'-' + ${#numbers.formatCurrency(orderDetail.discountAmount)}"
							>-0Ä‘</span
							>
						</div>
						<div class="summary-row">
							<span>Thuáº¿ (10%):</span>
							<span
									th:text="'+' + ${#numbers.formatCurrency((orderDetail.totalPrice - (orderDetail.discountAmount != null ? orderDetail.discountAmount : 0)) * 0.1)}"
							>0Ä‘</span
							>
						</div>
						<div class="summary-row total">
							<span>Tá»•ng cá»™ng:</span>
							<span
									class="total-amount"
									th:text="${#numbers.formatCurrency((orderDetail.totalPrice - (orderDetail.discountAmount != null ? orderDetail.discountAmount : 0)) * 1.1)}"
							>0Ä‘</span
							>
						</div>
						
						<!-- NÃºt xÃ¡c nháº­n thanh toÃ¡n ngay dÆ°á»›i Tá»•ng cá»™ng -->
						<form id="payment-confirm-form" th:action="@{/cashier/payment/confirm}" method="post"
						      style="display:none">
							<input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}"
							       th:value="${_csrf.token}"/>
							<input type="hidden" id="payment-session-id" name="sessionId"
							       th:value="${orderDetail != null ? orderDetail.sessionId : null}"/>
							<input type="hidden" id="payment-method" name="paymentMethod" value="CASH"/>
						</form>
						
						<div id="payment-buttons-container"
						     th:style="${tableStatus.toString() == 'WAITING_PAYMENT' && orderDetail != null && orderDetail.sessionId != null ? 'margin-top: 16px;' : 'margin-top: 16px; display: none;'}"
						     style="margin-top: 16px;">
							<button type="button" class="btn-action btn-confirm-payment btn-confirm-cash"
							        th:style="${orderDetail != null && orderDetail.paymentMethod != null && orderDetail.paymentMethod.toString() == 'CASH' ? '' : 'display: none;'}"
							        onclick="(function(){
                            if(confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ thanh toÃ¡n báº±ng tiá»n máº·t?')) {
                              document.getElementById('payment-method').value='CASH';
                              document.getElementById('payment-confirm-form').submit();
                            }
                          })()">
								ğŸ’µ XÃ¡c nháº­n thanh toÃ¡n tiá»n máº·t
							</button>
							<button type="button" class="btn-action btn-confirm-payment btn-confirm-qr"
							        th:style="${orderDetail != null && orderDetail.paymentMethod != null && orderDetail.paymentMethod.toString() == 'QR_BANKING' ? '' : 'display: none;'}"
							        onclick="(function(){
                            if(confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ thanh toÃ¡n qua QR Banking?')) {
                              document.getElementById('payment-method').value='QR_BANKING';
                              document.getElementById('payment-confirm-form').submit();
                            }
                          })()">
								ğŸ“± XÃ¡c nháº­n thanh toÃ¡n QR Banking
							</button>
						</div>
					</div>
					
					<div
							th:if="${orderDetail.note != null && !#strings.isEmpty(orderDetail.note)}"
							class="order-note"
					>
						<strong>Ghi chÃº:</strong>
						<span th:text="${orderDetail.note}"></span>
					</div>
				</div>
				
				<!-- ÄÆ°á»ng phÃ¢n cÃ¡ch vÃ  nÃºt actions cho bÃ n -->
				<div class="table-actions">
					<div class="action-buttons-group">
						<button
								class="btn-action btn-reserve"
								th:onclick="'openReservationModal(' + ${selectedTableId} + ')'"
						>
							ğŸ“… Äáº·t trÆ°á»›c
						</button>
						<a
								th:href="@{/cashier/tables/{tableId}/reservations(tableId=${selectedTableId})}"
								class="btn-action btn-view-reservations"
						>
							ğŸ“‹ Xem Ä‘Æ¡n Ä‘áº·t trÆ°á»›c
						</a>
					</div>
				</div>
			
			</div>
			
			<!-- Upcoming Reservations View -->
			<div th:if="${upcomingReservations != null}" class="reservation-list">
				<div class="reservation-header">
					<a th:href="@{/cashier}" class="btn-back-styled">â† Quay láº¡i</a>
				</div>
				
				<!-- Search Form - chá»‰ hiá»‡n trong upcoming reservations -->
				<div class="search-container" style="margin: 16px 0">
					<form
							th:action="@{/cashier/reservations/upcoming}"
							method="get"
							style="display: flex; gap: 8px"
					>
						<input
								type="text"
								name="search"
								th:value="${searchKeyword}"
								placeholder="TÃ¬m theo tÃªn, SÄT, hoáº·c sá»‘ bÃ n..."
								class="search-input"
								style="
                    flex: 1;
                    padding: 10px;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-size: 14px;
                  "
						/>
						<button
								type="submit"
								class="btn btn-primary"
								style="padding: 10px 20px; white-space: nowrap"
						>
							ğŸ” TÃ¬m kiáº¿m
						</button>
						<a
								th:href="@{/cashier/reservations/upcoming}"
								class="btn btn-secondary"
								style="
                    padding: 10px 20px;
                    text-decoration: none;
                    display: inline-block;
                  "
						>â†» XÃ³a lá»c</a
						>
					</form>
				</div>
				
				<div class="reservation-items">
					<div
							th:if="${#lists.isEmpty(upcomingReservations)}"
							class="no-reservations-card"
					>
						<div class="no-reservations-content">
							<div class="no-reservations-icon">ğŸ“…</div>
							<div class="no-reservations-text">
								ChÆ°a cÃ³ Ä‘Æ¡n Ä‘áº·t bÃ n nÃ o
							</div>
						</div>
					</div>
					
					<div
							th:each="reservation : ${upcomingReservations}"
							class="reservation-card"
					>
						<div class="reservation-card-header">
							<div class="reservation-table-name">
                    <span
		                    style="font-weight: 700; color: #2c3e50"
		                    th:text="${reservation.tableName}"
                    >BÃ n #</span
                    >
								<span
										style="font-size: 12px; color: #6c757d; margin-left: 8px"
								>| ÄÆ¡n #<span th:text="${reservation.id}">â€”</span></span
								>
							</div>
							<span
									th:class="'reservation-status ' + ${reservation.status.toString().toLowerCase()}"
									th:text="${reservation.status == 'CONFIRMED' ? 'ÄÃ£ xÃ¡c nháº­n' :
						                (reservation.status == 'ARRIVED' ? 'ÄÃ£ Ä‘áº¿n' : 
						                (reservation.status == 'CANCELED' ? 'ÄÃ£ há»§y' : 'KhÃ´ng Ä‘áº¿n'))}"
							>
                  </span>
						</div>
						
						<div class="reservation-time">
							ğŸ• Thá»i gian:
							<span
									th:text="${#temporals.format(reservation.startTime, 'EEE, dd MMM yyyy HH:mm')}"
							>â€”</span
							>
						</div>
						
						<div class="reservation-info">
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¤ KhÃ¡ch hÃ ng:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.customerName}"
								>â€”</span
								>
							</div>
							<div class="reservation-info-row">
                    <span class="reservation-info-label"
                    >ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</span
                    >
								<span
										class="reservation-info-value"
										th:text="${reservation.customerPhone}"
								>â€”</span
								>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¥ Sá»‘ khÃ¡ch:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.capacityExpected + ' ngÆ°á»i'}"
								>â€” ngÆ°á»i</span
								>
							</div>
							<div
									th:if="${reservation.note != null && !#strings.isEmpty(reservation.note)}"
									class="reservation-info-row"
							>
								<span class="reservation-info-label">ğŸ“ Ghi chÃº:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.note}"
								>â€”</span
								>
							</div>
						</div>
						
						<div
								th:if="${reservation.status.toString() == 'CONFIRMED'}"
								class="reservation-actions"
								style="display: flex; flex-direction: column; gap: 8px"
						>
							<!-- NÃºt má»Ÿ bÃ n cho khÃ¡ch (nÃºt chÃ­nh) -->
							<form
									th:action="@{/cashier/reservations/{id}/open(id=${reservation.id})}"
									th:if="${reservation.tableStatus != null && reservation.tableStatus == 'RESERVED' && reservation.isReadyToOpen()}"
									method="post"
									onsubmit="return confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ Ä‘áº¿n vÃ  má»Ÿ bÃ n?');"
							>
								<input
										type="hidden"
										th:name="${_csrf.parameterName}"
										th:value="${_csrf.token}"
								/>
								<input
										type="hidden"
										name="returnUrl"
										value="/cashier/reservations/upcoming"
								/>
								<button
										type="submit"
										class="btn-open-table"
										style="
                        width: 100%;
                        padding: 12px;
                        background-color: #2196f3;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 15px;
                      "
								>
									ğŸ”“ Má»Ÿ bÃ n cho khÃ¡ch
								</button>
							</form>
							
							<!-- CÃ¡c nÃºt phá»¥ -->
							<div style="display: flex; gap: 8px">
								<a
										th:href="@{/cashier/reservations/{id}/edit(id=${reservation.id}, returnUrl='/cashier/reservations/upcoming')}"
										class="btn-edit-reservation"
										style="
                        flex: 1;
                        text-align: center;
                        padding: 10px;
                        background-color: #4caf50;
                        color: white;
                        border-radius: 4px;
                        text-decoration: none;
                        border: none;
                        cursor: pointer;
                      "
								>
									âœï¸ Sá»­a
								</a>
								<form
										th:action="@{/cashier/reservations/{id}/delete(id=${reservation.id})}"
										method="post"
										onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n há»§y Ä‘áº·t bÃ n nÃ y?');"
										style="flex: 1"
								>
									<input
											type="hidden"
											th:name="${_csrf.parameterName}"
											th:value="${_csrf.token}"
									/>
									<input
											type="hidden"
											name="returnUrl"
											value="/cashier/reservations/upcoming"
									/>
									<button
											type="submit"
											class="btn-cancel-reservation"
											style="width: 100%"
									>
										âŒ Há»§y Ä‘áº·t bÃ n
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Payment History View -->
			<div
					th:if="${paymentHistory != null && showHistory == true}"
					class="reservation-list"
			>
				<div class="reservation-header">
					<a th:href="@{/cashier}" class="btn-back-styled">â† Quay láº¡i</a>
				</div>
				
				<h2
						style="
                font-size: 24px;
                font-weight: 700;
                color: #2c3e50;
                margin-bottom: 20px;
                padding: 20px 0;
              "
            >
              ğŸ“‹ Lá»‹ch sá»­ hÃ³a Ä‘Æ¡n
            </h2>

            <!-- Search Bar and Filter -->
            <div
              th:if="${!#lists.isEmpty(paymentHistory)}"
              style="
                margin-bottom: 16px;
                display: flex;
                justify-content: flex-end;
                gap: 12px;
                align-items: center;
              "
            >
              <select
                id="orderTypeFilter"
                style="
                  padding: 10px 14px;
                  border: 2px solid #ffe5cc;
                  border-radius: 10px;
                  background: #fffaf0;
                  color: #4a3528;
                  font-size: 14px;
                  width: 140px;
                  transition: all 0.2s ease;
                  margin: 0;
                  cursor: pointer;
                "
                onchange="applyFilters()"
                onfocus="this.style.borderColor='#ff9933'; this.style.boxShadow='0 0 0 4px rgba(255, 153, 51, 0.1)'; this.style.background='#ffffff'"
                onblur="this.style.borderColor='#ffe5cc'; this.style.boxShadow='none'; this.style.background='#fffaf0'"
              >
                <option value="ALL">Táº¥t cáº£</option>
                <option value="DINE_IN">Táº¡i bÃ n</option>
                <option value="TAKE_AWAY">Mang vá»</option>
              </select>
              <input
                type="text"
                id="invoice-search"
                placeholder="ğŸ” TÃ¬m theo mÃ£ Ä‘Æ¡n"
                style="
                  padding: 10px 14px;
                  border: 2px solid #ffe5cc;
                  border-radius: 10px;
                  background: #fffaf0;
                  color: #4a3528;
                  font-size: 14px;
                  width: 200px;
                  transition: all 0.2s ease;
                  margin: 0;
                "
                oninput="applyFilters()"
                onfocus="this.style.borderColor='#ff9933'; this.style.boxShadow='0 0 0 4px rgba(255, 153, 51, 0.1)'; this.style.background='#ffffff'"
                onblur="this.style.borderColor='#ffe5cc'; this.style.boxShadow='none'; this.style.background='#fffaf0'"
              />
            </div>

            <div
              th:if="${!#lists.isEmpty(paymentHistory)}"
              id="history-no-results"
              class="no-reservations-card"
              style="display: none"
            >
              <div class="no-reservations-content">
                <div class="no-reservations-icon">ğŸ”</div>
                <div class="no-reservations-text">KhÃ´ng tÃ¬m tháº¥y hÃ³a Ä‘Æ¡n phÃ¹ há»£p</div>
              </div>
            </div>

            <div
              th:if="${#lists.isEmpty(paymentHistory)}"
              class="no-reservations-card"
            >
              <div class="no-reservations-content">
                <div class="no-reservations-icon">ğŸ“„</div>
                <div class="no-reservations-text">ChÆ°a cÃ³ hÃ³a Ä‘Æ¡n nÃ o</div>
              </div>
            </div>

            <div
              th:each="order : ${paymentHistory}"
              class="reservation-card invoice-card"
              th:data-order-id="${order.orderId}"
              th:data-order-type="${order.orderType != null ? order.orderType.toString() : ''}"
              style="max-width: 100%"
            >
              <!-- Order Header -->
              <div class="reservation-card-header" style="margin-bottom: 16px">
                <div>
                  <div
                    style="
                      font-size: 18px;
                      font-weight: 700;
                      color: #2c3e50;
                      margin-bottom: 4px;
                    "
							>
								ÄÆ¡n hÃ ng #<span th:text="${order.orderId}">â€”</span>
							</div>
							<div style="font-size: 12px; color: #6c757d">
								ğŸ“…
								<span
										th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}"
								>â€”</span
								>
							</div>
						</div>
						<span
								th:style="${order.orderStatus != null && order.orderStatus.toString() == 'PREPARING' ? 'background: #fff3cd; color: #856404;' : (order.orderStatus != null && order.orderStatus.toString() == 'COMPLETED' ? 'background: #d4edda; color: #155724;' : (order.orderStatus != null && order.orderStatus.toString() == 'CANCELLED' ? 'background: #f8d7da; color: #721c24;' : 'background: #d1ecf1; color: #0c5460;'))}"
								style="
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 600;
                    text-transform: uppercase;
                  "
						>
                  <span
		                  th:text="${order.orderStatus != null && order.orderStatus.toString() == 'PREPARING' ? 'Äang chuáº©n bá»‹' : (order.orderStatus != null && order.orderStatus.toString() == 'COMPLETED' ? 'HoÃ n thÃ nh' : (order.orderStatus != null && order.orderStatus.toString() == 'CANCELLED' ? 'ÄÃ£ há»§y' : 'Äang xá»­ lÃ½'))}"
                  >â€”</span
                  >
                </span>
						<span
								th:if="${order.paymentStatus != null}"
								th:style="${order.paymentStatus.toString() == 'PAID' ? 'background: #d4edda; color: #155724;' : (order.paymentStatus.toString() == 'PENDING' ? 'background: #fff3cd; color: #856404;' : 'background: #f8d7da; color: #721c24;')}"
								style="
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 600;
                    text-transform: uppercase;
                    margin-left: 8px;
                  "
						>
                  <span
		                  th:text="${order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : (order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½' : 'ChÆ°a thanh toÃ¡n')}"
                  >â€”</span
                  >
                </span>
					</div>
					
					<!-- Order Details Section -->
					<div
							class="reservation-info"
							style="
                  background: #f8f9fa;
                  padding: 12px;
                  border-radius: 8px;
                  margin-bottom: 12px;
                "
					>
						<div class="reservation-info-row">
							<span class="reservation-info-label">ğŸª‘ BÃ n:</span>
							<span
									class="reservation-info-value"
									th:text="${order.tableName ?: 'Take-away'}"
							>â€”</span
							>
						</div>
						<div class="reservation-info-row">
							<span class="reservation-info-label">ğŸ½ï¸ Loáº¡i Ä‘Æ¡n:</span>
							<span
									class="reservation-info-value"
									th:text="${order.orderType != null && order.orderType.toString() == 'DINE_IN' ? 'Táº¡i cá»­a hÃ ng' : 'Take-away'}"
							>â€”</span
							>
						</div>
						<div class="reservation-info-row">
                  <span class="reservation-info-label"
                  >ğŸ’³ PhÆ°Æ¡ng thá»©c Thanh ToÃ¡n:</span
                  >
							<span
									class="reservation-info-value"
									th:text="${order.paymentMethod != null ? (order.paymentMethod.toString() == 'CASH' ? 'Tiá»n máº·t' : (order.paymentMethod.toString() == 'QR_BANKING' ? 'QR Code' : (order.paymentMethod.toString() == 'CREDIT_CARD' ? 'Tháº» tÃ­n dá»¥ng' : order.paymentMethod.toString()))) : 'ChÆ°a chá»n'}"
							>â€”</span
							>
						</div>
						<div class="reservation-info-row">
                  <span class="reservation-info-label"
                  >ğŸ’° Tráº¡ng thÃ¡i Thanh ToÃ¡n:</span
                  >
							<span
									class="reservation-info-value"
									th:class="${order.paymentStatus != null && order.paymentStatus.toString() == 'PAID' ? 'payment-status paid' : (order.paymentStatus != null && order.paymentStatus.toString() == 'PENDING' ? 'payment-status pending' : 'payment-status unpaid')}"
									th:text="${order.paymentStatus != null ? (order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : (order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½' : 'ChÆ°a thanh toÃ¡n')) : 'ChÆ°a thanh toÃ¡n'}"
							>â€”</span
							>
						</div>
					</div>
					
					<!-- Order Summary -->
					<div
							style="
                  margin-top: 16px;
                  padding-top: 12px;
                  border-top: 2px solid #e8e8e8;
                "
					>
						<div
								class="summary-row total"
								style="
                    display: flex;
                    justify-content: space-between;
                    font-weight: 700;
                    font-size: 16px;
                    color: #2c3e50;
                  "
						>
							<span>Tá»•ng cá»™ng:</span>
							<span
									style="color: #e74c3c; font-size: 18px"
									th:text="${#numbers.formatCurrency(order.totalPrice)}"
							>0Ä‘</span
							>
						</div>
					</div>
					
					<!-- Action Button -->
					<div style="margin-top: 12px; text-align: center">
						<button
								th:onclick="'toggleOrderDetail(' + ${order.orderId} + ')'"
								th:id="'toggle-btn-' + ${order.orderId}"
								class="btn-detail-order"
								style="
                    padding: 8px 16px;
                    background-color: #007bff;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: background-color 0.2s;
                  "
								onmouseover="this.style.backgroundColor='#0056b3'"
								onmouseout="this.style.backgroundColor='#007bff'"
						>
							ğŸ“‹ Xem chi tiáº¿t
						</button>
					</div>
					
					<!-- Order Detail Section (Hidden by default) -->
					<div
							th:id="'order-detail-' + ${order.orderId}"
							class="order-detail-section"
							style="
                  display: none;
                  margin-top: 16px;
                  padding: 16px;
                  background: #f8f9fa;
                  border-radius: 8px;
                  border: 1px solid #e9ecef;
                "
					>
						<!-- Receipt Header -->
						<div style="text-align: center; margin-bottom: 20px">
							<div
									style="
                      font-size: 18px;
                      font-weight: bold;
                      margin-bottom: 8px;
                      text-transform: uppercase;
                    "
							>
								CHI TIáº¾T ÄÆ N HÃ€NG
							</div>
							<div
									style="
                      font-size: 16px;
                      font-weight: bold;
                      margin-bottom: 4px;
                    "
							>
								PizzarIO
							</div>
							<div style="font-size: 12px; margin-bottom: 4px">
								KM29 - ÄL. ThÄƒng Long
							</div>
							<div style="font-size: 12px; margin-bottom: 10px">
								ÄT: 0123456678-0987654321
							</div>
							<div
									style="text-align: center; margin: 10px 0; font-size: 12px"
							>
								*****************
							</div>
						</div>
						
						<!-- Order Status -->
						<div style="text-align: center; margin-bottom: 15px">
                  <span
		                  th:class="'order-status ' + ${order.orderStatus != null ? order.orderStatus.toString().toLowerCase() : ''}"
		                  th:text="${order.orderStatus != null && order.orderStatus.toString() == 'PREPARING' ? 'Äang chuáº©n bá»‹' : (order.orderStatus != null && order.orderStatus.toString() == 'COMPLETED' ? 'HoÃ n thÃ nh' : (order.orderStatus != null && order.orderStatus.toString() == 'CANCELLED' ? 'ÄÃ£ há»§y' : 'Äang xá»­ lÃ½'))}"
		                  style="
                      padding: 4px 12px;
                      border-radius: 20px;
                      font-size: 12px;
                      font-weight: 600;
                      text-transform: uppercase;
                      margin-right: 8px;
                    "
                  >
                  </span>
							<span
									th:class="'payment-status ' + ${order.paymentStatus.toString().toLowerCase()}"
									th:text="${order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : (order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½' : 'ChÆ°a thanh toÃ¡n')}"
									style="
                      padding: 4px 12px;
                      border-radius: 20px;
                      font-size: 12px;
                      font-weight: 600;
                      text-transform: uppercase;
                    "
							>
                  </span>
						</div>
						
						<!-- Transaction Information -->
						<div style="margin-bottom: 15px; font-size: 12px">
							<div
									style="
                      display: flex;
                      justify-content: space-between;
                      margin-bottom: 4px;
                    "
							>
                    <span
		                    th:text="${#temporals.format(order.createdAt, 'dd-MM-yyyy')}"
                    >20-09-2025</span
                    >
								<span
										th:text="${#temporals.format(order.createdAt, 'HH:mm:ss')}"
								>11:02:37</span
								>
							</div>
							<div style="margin-bottom: 4px">
								MÃ£ Ä‘Æ¡n hÃ ng:
								<strong>#<span th:text="${order.orderId}">â€”</span></strong>
							</div>
							<div style="margin-bottom: 4px">
								KhÃ¡ch hÃ ng:
								<span th:text="${order.customerName ?: 'KhÃ¡ch vÃ£ng lai'}"
								>KhÃ¡ch vÃ£ng lai</span
								>
								<span
										th:if="${order.customerPhone != null}"
										style="color: #6c757d"
								>
                      (SÄT: <span th:text="${order.customerPhone}">â€”</span>)
                    </span>
							</div>
							<div style="margin-bottom: 4px">
                    <span th:if="${order.tableName != null}">
                      BÃ n: <span th:text="${order.tableName}">05</span>
                    </span>
								<span th:if="${order.tableName == null}">
                      Loáº¡i Ä‘Æ¡n: Take-away
                    </span>
							</div>
							<div
									th:if="${order.createdByStaffName != null}"
									style="margin-bottom: 10px"
							>
								NhÃ¢n viÃªn phá»¥c vá»¥:
								<span th:text="${order.createdByStaffName}">â€”</span>
							</div>
						</div>
						
						<!-- Items Header -->
						<div
								style="
                    display: grid;
                    grid-template-columns: 1fr 70px 1fr;
                    column-gap: 8px;
                    font-size: 12px;
                    font-weight: bold;
                    margin-bottom: 8px;
                    border-bottom: 1px solid #000;
                    padding-bottom: 4px;
                  "
						>
							<div>TÃªn mÃ³n</div>
							<div style="text-align: center">Sá»‘ lÆ°á»£ng</div>
							<div style="text-align: right">ThÃ nh tiá»n</div>
						</div>
						
						<!-- Order Items -->
						<div
								th:each="item : ${order.items}"
								style="
                    display: grid;
                    grid-template-columns: 1fr 70px 1fr;
                    column-gap: 8px;
                    font-size: 12px;
                    margin-bottom: 4px;
                  "
						>
							<div th:text="${item.sizeName != null && !#strings.isEmpty(item.sizeName) ? item.productName + ' (' + item.sizeName + ')' : item.productName}">Pizza BÃ²</div>
							<div style="text-align: center" th:text="${item.quantity}">
								1
							</div>
							<div
									style="text-align: right"
									th:text="${#numbers.formatDecimal(item.totalPrice, 0, 'COMMA', 0, 'POINT')}"
							>
								245,000
							</div>
						</div>
						
						<!-- Discount Information -->
						<div
								th:if="${order.discountAmount != null && order.discountAmount > 0}"
								style="
                    display: grid;
                    grid-template-columns: 1fr 70px 1fr;
                    column-gap: 8px;
                    font-size: 12px;
                    margin-bottom: 4px;
                  "
						>
							<div>Giáº£m giÃ¡:</div>
							<div style="text-align: center">-</div>
							<div
									style="text-align: right"
									th:text="'-' + ${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')}"
							>
								-0
							</div>
						</div>
						
						<!-- Tax Information -->
						<div
								style="
                    display: grid;
                    grid-template-columns: 1fr 70px 1fr;
                    column-gap: 8px;
                    font-size: 12px;
                    margin-bottom: 4px;
                  "
						>
							<div>Thuáº¿ (10%):</div>
							<div style="text-align: center">-</div>
							<div
									style="text-align: right"
									th:text="${#numbers.formatDecimal(order.totalPrice * 0.1 / 1.1, 0, 'COMMA', 0, 'POINT')}"
							>
								0
							</div>
						</div>
						
						<!-- Total Section -->
						<div
								style="
                    margin-top: 15px;
                    border-top: 1px solid #000;
                    padding-top: 8px;
                  "
						>
							<div
									style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 14px;
                      font-weight: bold;
                      margin-bottom: 4px;
                    "
							>
								<span>Táº¡m tÃ­nh:</span>
								<span
										th:text="${#numbers.formatDecimal(order.totalPrice / 1.1, 0, 'COMMA', 0, 'POINT')}"
								>745,000</span
								>
							</div>
							<div
									th:if="${order.discountAmount != null && order.discountAmount > 0}"
									style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 14px;
                      font-weight: bold;
                      margin-bottom: 4px;
                    "
							>
								<span>Giáº£m giÃ¡:</span>
								<span
										th:text="'-' + ${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')}"
								>-0</span
								>
							</div>
							<div
									style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 14px;
                      font-weight: bold;
                      margin-bottom: 4px;
                    "
							>
								<span>Thuáº¿ (10%):</span>
								<span
										th:text="${#numbers.formatDecimal(order.totalPrice * 0.1 / 1.1, 0, 'COMMA', 0, 'POINT')}"
								>0</span
								>
							</div>
							<div
									style="
                      display: flex;
                      justify-content: space-between;
                      font-size: 16px;
                      font-weight: bold;
                      border-top: 1px solid #000;
                      padding-top: 8px;
                    "
							>
								<span>Tá»•ng cá»™ng:</span>
								<span
										th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')}"
								>745,000</span
								>
							</div>
						</div>
						
						<!-- Payment Method Section -->
						<div
								style="
                    text-align: center;
                    margin: 20px 0;
                    padding: 15px;
                    background: #f9f9f9;
                    border-radius: 8px;
                  "
						>
							<div
									style="
                      font-size: 14px;
                      font-weight: bold;
                      margin-bottom: 10px;
                    "
							>
								PhÆ°Æ¡ng thá»©c thanh toÃ¡n
							</div>
							<div
									th:if="${order.paymentMethod != null && order.paymentMethod.toString() == 'QR_BANKING'}"
							>
								<div
										style="
                        color: #007bff;
                        font-size: 16px;
                        margin-bottom: 10px;
                      "
								>
									<strong>Thanh toÃ¡n báº±ng QR Banking</strong><br/>
									<span
											style="font-size: 12px"
											th:text="${order.paymentStatus != null && order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng' : (order.paymentStatus != null && order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½ thanh toÃ¡n' : 'ChÆ°a thanh toÃ¡n')}"
									>ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng</span
									>
								</div>
							</div>
							<div
									th:if="${order.paymentMethod != null && order.paymentMethod.toString() == 'CASH'}"
							>
								<div
										style="
                        color: #2e7d32;
                        font-size: 16px;
                        margin-bottom: 10px;
                      "
								>
									<strong>Thanh toÃ¡n báº±ng tiá»n máº·t</strong><br/>
									<span
											style="font-size: 12px"
											th:text="${order.paymentStatus != null && order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng' : (order.paymentStatus != null && order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½ thanh toÃ¡n' : 'ChÆ°a thanh toÃ¡n')}"
									>ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng</span
									>
								</div>
							</div>
							<div
									th:if="${order.paymentMethod != null && order.paymentMethod.toString() == 'CREDIT_CARD'}"
							>
								<div
										style="
                        color: #6f42c1;
                        font-size: 16px;
                        margin-bottom: 10px;
                      "
								>
									<strong>Thanh toÃ¡n báº±ng tháº» tÃ­n dá»¥ng</strong><br/>
									<span
											style="font-size: 12px"
											th:text="${order.paymentStatus != null && order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng' : (order.paymentStatus != null && order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½ thanh toÃ¡n' : 'ChÆ°a thanh toÃ¡n')}"
									>ÄÃ£ thanh toÃ¡n thÃ nh cÃ´ng</span
									>
								</div>
							</div>
							<div th:if="${order.paymentMethod == null}">
								<div
										style="
                        color: #6c757d;
                        font-size: 16px;
                        margin-bottom: 10px;
                      "
								>
									<strong>ChÆ°a chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n</strong><br/>
									<span
											style="font-size: 12px"
											th:text="${order.paymentStatus != null && order.paymentStatus.toString() == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : (order.paymentStatus != null && order.paymentStatus.toString() == 'PENDING' ? 'Äang xá»­ lÃ½ thanh toÃ¡n' : 'ChÆ°a thanh toÃ¡n')}"
									>ChÆ°a thanh toÃ¡n</span
									>
								</div>
							</div>
						</div>
						
						<!-- Order Note -->
						<div
								th:if="${order.note != null && !#strings.isEmpty(order.note)}"
								style="
                    margin: 15px 0;
                    padding: 10px;
                    background: #f8f9fa;
                    border-radius: 4px;
                  "
                >
                  <strong>Ghi chÃº Ä‘Æ¡n hÃ ng:</strong><br />
                  <span th:text="${order.note}"></span>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 20px">
                  <button
                    th:onclick="'printReceipt(' + ${order.orderId} + ')'"
                    style="
                      padding: 10px 20px;
                      margin: 5px;
                      background-color: #007bff;
                      color: white;
                      border: none;
                      border-radius: 4px;
                      cursor: pointer;
                      font-size: 14px;
                      font-weight: bold;
                    "
							>
								In hÃ³a Ä‘Æ¡n
							</button>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Table Reservations View -->
			<div th:if="${tableReservations != null}" class="reservation-list">
				<div
						class="detail-card"
						style="margin-bottom: 16px; box-shadow: none"
				>
					<div class="reservation-header">
						<a
								th:href="@{/cashier/tables/{id}/order(id=${selectedTableId})}"
								class="btn-back-styled"
						>
							â† Quay láº¡i bÃ n <span th:text="${selectedTableId}">â€”</span>
						</a>
					</div>
				</div>
				<div class="reservation-items">
					<div
							th:if="${#lists.isEmpty(tableReservations)}"
							class="no-reservations-card"
					>
						<div class="no-reservations-content">
							<div class="no-reservations-icon">ğŸ“…</div>
							<div class="no-reservations-text">
								ChÆ°a cÃ³ Ä‘Æ¡n Ä‘áº·t bÃ n nÃ o
							</div>
						</div>
					</div>
					
					<div
							th:each="reservation : ${tableReservations}"
							class="reservation-card"
					>
						<div class="reservation-card-header">
							<div class="reservation-table-name">
                    <span style="font-weight: 700; color: #2c3e50"
                    >BÃ n <span th:text="${reservation.tableId}">#</span></span
                    >
								<span
										style="font-size: 12px; color: #6c757d; margin-left: 8px"
								>| ÄÆ¡n #<span th:text="${reservation.id}">â€”</span></span
								>
							</div>
							<span
									th:class="'reservation-status ' + ${reservation.status.toString().toLowerCase()}"
									th:text="${reservation.status == 'CONFIRMED' ? 'ÄÃ£ xÃ¡c nháº­n' :
							                (reservation.status == 'ARRIVED' ? 'ÄÃ£ Ä‘áº¿n' : 
							                (reservation.status == 'CANCELED' ? 'ÄÃ£ há»§y' : 'KhÃ´ng Ä‘áº¿n'))}"
							>
                  </span>
						</div>
						
						<div class="reservation-time">
							ğŸ•
							<span
									th:text="${#temporals.format(reservation.startTime, 'EEE, dd MMM yyyy HH:mm')}"
							>â€”</span
							>
						</div>
						
						<div class="reservation-info">
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¤ KhÃ¡ch hÃ ng:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.customerName}"
								>â€”</span
								>
							</div>
							<div class="reservation-info-row">
                    <span class="reservation-info-label"
                    >ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</span
                    >
								<span
										class="reservation-info-value"
										th:text="${reservation.customerPhone}"
								>â€”</span
								>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¥ Sá»‘ khÃ¡ch:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.capacityExpected + ' ngÆ°á»i'}"
								>â€” ngÆ°á»i</span
								>
							</div>
							<div
									th:if="${reservation.note != null && !#strings.isEmpty(reservation.note)}"
									class="reservation-info-row"
							>
								<span class="reservation-info-label">ğŸ“ Ghi chÃº:</span>
								<span
										class="reservation-info-value"
										th:text="${reservation.note}"
								>â€”</span
								>
							</div>
						</div>
						
						<div
								th:if="${reservation.status.toString() == 'CONFIRMED'}"
								class="reservation-actions"
						>
							<!-- NÃºt má»Ÿ bÃ n cho khÃ¡ch (nÃºt chÃ­nh) -->
							<form
									th:action="@{/cashier/reservations/{id}/open(id=${reservation.id})}"
									th:if="${reservation.tableStatus != null && reservation.tableStatus == 'RESERVED' && reservation.isReadyToOpen()}"
									method="post"
									onsubmit="return confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ Ä‘áº¿n vÃ  má»Ÿ bÃ n?');"
							>
								<input
										type="hidden"
										th:name="${_csrf.parameterName}"
										th:value="${_csrf.token}"
								/>
								<input
										type="hidden"
										name="returnUrl"
										th:value="'/cashier/tables/' + ${selectedTableId} + '/reservations'"
								/>
								<button type="submit" class="btn-open-table">
									ğŸ”“ Má»Ÿ bÃ n cho khÃ¡ch
								</button>
							</form>
							
							<!-- CÃ¡c nÃºt phá»¥ -->
							<div class="reservation-secondary-actions">
								<a
										th:href="@{/cashier/reservations/{id}/edit(id=${reservation.id}, returnUrl='/cashier/tables/' + ${selectedTableId} + '/reservations')}"
										class="btn-edit-reservation"
								>
									âœï¸ Sá»­a
								</a>
								<form
										th:action="@{/cashier/reservations/{id}/delete(id=${reservation.id})}"
										method="post"
										onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n há»§y Ä‘áº·t bÃ n nÃ y?');"
								>
									<input
											type="hidden"
											th:name="${_csrf.parameterName}"
											th:value="${_csrf.token}"
									/>
									<input
											type="hidden"
											name="returnUrl"
											th:value="'/cashier/tables/' + ${selectedTableId} + '/reservations'"
									/>
									<button type="submit" class="btn-cancel-reservation">
										âŒ Há»§y Ä‘áº·t bÃ n
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>

<div class="toast-container" id="toast-container">
	<!-- Flash messages tá»« redirect (chá»‰ hiá»ƒn thá»‹ náº¿u khÃ´ng pháº£i lá»—i validation modal) -->
	<div
			th:if="${successMessage}"
			class="toast success"
			style="display: block"
			th:attr="data-message=${successMessage},
                 data-type='success',
                 data-table-id=${selectedTableId != null ? selectedTableId : ''},
                 data-reservation-id=${lastReservationId != null ? lastReservationId : ''}"
	>
		<span th:text="${successMessage}"></span>
	</div>
	<div
			th:if="${errorMessage != null and (showReservationModal == null or !showReservationModal)}"
			class="toast error"
			style="display: block"
			th:attr="data-message=${errorMessage},
                 data-type='error',
                 data-table-id=${selectedTableId != null ? selectedTableId : ''},
                 data-reservation-id=${lastReservationId != null ? lastReservationId : ''}"
	>
		<span th:text="${errorMessage}"></span>
	</div>
</div>

<!-- Modal Toast Container cho errors trong modal -->
<div class="modal-toast-container" id="modal-toast-container"></div>

<!-- Modal Ä‘áº·t bÃ n -->
<div id="reservation-modal" class="modal">
	<div class="modal-content">
		<div class="modal-header">
			<h2>Äáº·t trÆ°á»›c bÃ n</h2>
			<span class="modal-close" onclick="closeReservationModal()"
			>&times;</span
			>
		</div>
		<div class="modal-body">
			<form
					id="reservation-form"
					th:action="@{/cashier/reservations}"
					method="post"
					th:object="${reservationCreateDTO}"
			>
				<input
						type="hidden"
						th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}"
				/>
				<input type="hidden" id="table-id-hidden" th:field="*{tableId}"/>
				
				<!-- Hiá»ƒn thá»‹ lá»—i chung (global errors) -->
				<div th:if="${#fields.hasGlobalErrors()}" class="form-alert-error">
					<span class="alert-icon">âš ï¸</span>
					<div
							th:each="error : ${#fields.globalErrors()}"
							th:text="${error}"
							class="error-message"
					></div>
				</div>
				
				<div class="form-group">
					<label for="table-id-display">BÃ n sá»‘</label>
					<input
							type="text"
							id="table-id-display"
							readonly
							class="form-control"
							th:field="*{tableId}"
					/>
				</div>
				
				<div class="form-group">
					<label for="customer-name"
					>TÃªn khÃ¡ch hÃ ng <span class="required">*</span></label
					>
					<input
							type="text"
							id="customer-name"
							th:field="*{customerName}"
							required
							th:classappend="${#fields.hasErrors('customerName')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('customerName')}"
							th:errors="*{customerName}"
					></div>
				</div>
				
				<div class="form-group">
					<label for="customer-phone"
					>Sá»‘ Ä‘iá»‡n thoáº¡i <span class="required">*</span></label
					>
					<input
							type="tel"
							id="customer-phone"
							th:field="*{customerPhone}"
							required
							th:classappend="${#fields.hasErrors('customerPhone')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('customerPhone')}"
							th:errors="*{customerPhone}"
					></div>
				</div>
				
				<div class="form-group">
					<label for="customer-capacity"
					>Sá»‘ lÆ°á»£ng dá»± kiáº¿n <span class="required">*</span></label
					>
					<input
							type="number"
							id="customer-capacity"
							th:field="*{capacityExpected}"
							required
							th:classappend="${#fields.hasErrors('capacityExpected')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('capacityExpected')}"
							th:errors="*{capacityExpected}"
					></div>
				</div>
				
				<div class="form-row">
					<div class="form-group half">
						<label for="start-time"
						>Thá»i gian báº¯t Ä‘áº§u <span class="required">*</span></label
						>
						<input
								type="datetime-local"
								id="start-time"
								th:field="*{startTime}"
								required
								th:classappend="${#fields.hasErrors('startTime')} ? 'is-invalid' : ''"
								class="form-control"
						/>
						<div
								class="invalid-feedback"
								th:if="${#fields.hasErrors('startTime')}"
								th:errors="*{startTime}"
						></div>
					</div>
				</div>
				
				<div class="form-group">
					<label for="note">Ghi chÃº (tÃ¹y chá»n)</label>
					<textarea
							id="note"
							th:field="*{note}"
							th:classappend="${#fields.hasErrors('note')} ? 'is-invalid' : ''"
							class="form-control"
							rows="3"
							placeholder="Nháº­p ghi chÃº náº¿u cÃ³..."
					></textarea>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('note')}"
							th:errors="*{note}"
					></div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button
					type="button"
					class="btn btn-secondary"
					onclick="closeReservationModal()"
			>
				Há»§y
			</button>
			<button type="submit" form="reservation-form" class="btn btn-primary">
				XÃ¡c nháº­n Ä‘áº·t bÃ n
			</button>
		</div>
	</div>
</div>

<!-- Modal cáº­p nháº­t Ä‘áº·t bÃ n -->
<div
		id="update-reservation-modal"
		class="modal"
		th:if="${reservationUpdateDTO != null}"
>
	<div class="modal-content">
		<div class="modal-header">
			<h2>Cáº­p nháº­t Ä‘áº·t bÃ n</h2>
			<span class="modal-close" onclick="closeUpdateModal()">&times;</span>
		</div>
		<div class="modal-body">
			<form
					id="update-reservation-form"
					th:action="@{/cashier/reservations/{id}/update(id=${reservationUpdateDTO.id})}"
					method="post"
					th:object="${reservationUpdateDTO}"
			>
				<input
						type="hidden"
						th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}"
				/>
				<input type="hidden" name="returnUrl" th:value="${returnUrl}"/>
				
				<!-- Hiá»ƒn thá»‹ lá»—i chung (global errors) -->
				<div th:if="${#fields.hasGlobalErrors()}" class="form-alert-error">
					<span class="alert-icon">âš ï¸</span>
					<div
							th:each="error : ${#fields.globalErrors()}"
							th:text="${error}"
							class="error-message"
					></div>
				</div>
				
				<div class="form-group">
					<label for="update-table-id">BÃ n sá»‘</label>
					<input
							type="text"
							id="update-table-id"
							readonly
							class="form-control"
							th:value="'BÃ n ' + ${reservationUpdateDTO.tableId}"
					/>
				</div>
				
				<div class="form-group">
					<label for="update-customer-name"
					>TÃªn khÃ¡ch hÃ ng <span class="required">*</span></label
					>
					<input
							type="text"
							id="update-customer-name"
							th:field="*{customerName}"
							required
							th:classappend="${#fields.hasErrors('customerName')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('customerName')}"
							th:errors="*{customerName}"
					></div>
				</div>
				
				<div class="form-group">
					<label for="update-customer-phone"
					>Sá»‘ Ä‘iá»‡n thoáº¡i <span class="required">*</span></label
					>
					<input
							type="tel"
							id="update-customer-phone"
							th:field="*{customerPhone}"
							required
							th:classappend="${#fields.hasErrors('customerPhone')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('customerPhone')}"
							th:errors="*{customerPhone}"
					></div>
				</div>
				
				<div class="form-group">
					<label for="update-customer-capacity"
					>Sá»‘ lÆ°á»£ng dá»± kiáº¿n <span class="required">*</span></label
					>
					<input
							type="number"
							id="update-customer-capacity"
							th:field="*{capacityExpected}"
							required
							th:classappend="${#fields.hasErrors('capacityExpected')} ? 'is-invalid' : ''"
							class="form-control"
					/>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('capacityExpected')}"
							th:errors="*{capacityExpected}"
					></div>
				</div>
				
				<div class="form-row">
					<div class="form-group half">
						<label for="update-start-time"
						>Thá»i gian báº¯t Ä‘áº§u <span class="required">*</span></label
						>
						<input
								type="datetime-local"
								id="update-start-time"
								th:field="*{startTime}"
								required
								th:classappend="${#fields.hasErrors('startTime')} ? 'is-invalid' : ''"
								class="form-control"
						/>
						<div
								class="invalid-feedback"
								th:if="${#fields.hasErrors('startTime')}"
								th:errors="*{startTime}"
						></div>
					</div>
				</div>
				
				<div class="form-group">
					<label for="update-note">Ghi chÃº (tÃ¹y chá»n)</label>
					<textarea
							id="update-note"
							th:field="*{note}"
							th:classappend="${#fields.hasErrors('note')} ? 'is-invalid' : ''"
							class="form-control"
							rows="3"
							placeholder="Nháº­p ghi chÃº náº¿u cÃ³..."
					></textarea>
					<div
							class="invalid-feedback"
							th:if="${#fields.hasErrors('note')}"
							th:errors="*{note}"
					></div>
				</div>
			</form>
		</div>
		<div class="modal-footer">
			<button
					type="button"
					class="btn btn-secondary"
					onclick="closeUpdateModal()"
			>
				Há»§y
			</button>
			<button
					type="submit"
					form="update-reservation-form"
					class="btn btn-primary"
			>
				Cáº­p nháº­t
			</button>
		</div>
	</div>
</div>

<!-- Notification History Modal -->
<div id="notification-modal" class="modal">
	<div class="modal-content" style="max-width: 800px;">
		<div class="modal-header">
			<h2>ğŸ”” Lá»‹ch sá»­ thÃ´ng bÃ¡o</h2>
			<span class="modal-close" onclick="closeNotificationModal()">&times;</span>
		</div>
		<div class="modal-body" style="max-height: 60vh;">
			<div class="notification-filters"
			     style="margin-bottom: 16px; display: flex; gap: 8px; justify-content: flex-end;">
				<button class="btn btn-secondary" onclick="clearAllNotifications()"
				        style="font-size: 12px; padding: 6px 12px;">
					ğŸ—‘ï¸ XÃ³a táº¥t cáº£
				</button>
			</div>
			<div id="notification-list" class="notification-list">
				<!-- Notifications will be inserted here by JavaScript -->
			</div>
		</div>
	</div>
</div>

<!-- Edit Order Sliding Panel -->
<div id="edit-order-overlay" class="edit-order-overlay" onclick="closeEditOrderPanel()"></div>
<div id="edit-order-panel" class="edit-order-panel">
	<div class="panel-header">
		<h2>âœï¸ Chá»‰nh sá»­a order - BÃ n <span id="edit-table-number" th:text="${tableId}"></span></h2>
		<button class="panel-close" onclick="closeEditOrderPanel()" type="button">&times;</button>
	</div>
	
	<div class="panel-body">
		<!-- Menu Section -->
		<div class="menu-section">
			<h3>ğŸ• Menu mÃ³n Äƒn</h3>
			<div class="menu-tabs">
				<button class="menu-tab active" onclick="filterMenu(0)">Táº¥t cáº£</button>
				<th:block th:each="cat : ${categories}">
					<button class="menu-tab"
					        th:text="${cat.name}"
					        th:onclick="'filterMenu(' + ${cat.id} + ')'"
					        th:attr="data-category-id=${cat.id}">
					</button>
				</th:block>
			</div>
			
			<div class="menu-items" id="menu-items-list">
				<!-- Menu items loaded from database -->
				<div class="menu-item"
				     th:each="p : ${products}"
				     th:if="${p.active}"
				     th:attr="data-category-id=${p.categoryId},
                          data-product-id=${p.id},
                          data-product-name=${p.name}">
					<div class="menu-item-info">
						<div class="menu-item-name" th:text="${p.name}">Product Name</div>
					</div>
					<button class="btn-add-item" onclick="openSizeModal(this)">
						<span>+</span>
					</button>
					<!-- Hidden div to store sizes data as JSON -->
					<div class="product-sizes-data" style="display: none;">
						<th:block th:if="${p.sizes != null && !p.sizes.isEmpty()}">
                  <span th:each="size, iterStat : ${p.sizes}"
                        th:attr="data-size-id=${size.sizeId},
                                 data-size-name=${size.sizeName},
                                 data-size-price=${size.currentPrice},
                                 data-base-price=${size.basePrice},
                                 data-is-on-sale=${size.onFlashSale}">
                  </span>
						</th:block>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Current Order Section -->
		<div class="current-order-section">
			<h3>ğŸ“‹ ÄÆ¡n hiá»‡n táº¡i</h3>
			<div class="current-order-items" id="current-order-items">
				<!-- Order items will be added here dynamically -->
				<th:block th:if="${orderDetail != null && orderDetail.items != null && !orderDetail.items.isEmpty()}">
					<div class="order-edit-item"
					     th:each="item : ${orderDetail.items}"
					     th:attr="data-item-id=${item.id},
                            data-product-id=${item.productSize.product.id},
                            data-size-id=${item.productSize.size.id},
                            data-price=${item.unitPrice},
                            data-base-price=${item.productSize.basePrice},
                            data-is-on-sale=${item.productSize.onFlashSale}">
						<div class="order-edit-item-info">
							<div class="order-edit-item-name" 
								th:text="${item.sizeName != null && !#strings.isEmpty(item.sizeName) ? item.productName + ' (' + item.sizeName + ')' : item.productName}">Product Name</div>
							<div class="order-edit-item-note">
								<input type="text"
								       class="item-note-input"
								       placeholder="Ghi chÃº"
								       th:value="${item.note}"
								       style="width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
							</div>
						</div>
						<div class="order-edit-item-controls">
                  <span style="margin-right: 8px;">
                    x<span class="quantity" th:text="${item.quantity}">1</span>
                  </span>
							<button class="btn-remove-item" onclick="removeItemFromPanel(this)">ğŸ—‘ï¸</button>
						</div>
						<div class="order-edit-item-price">
                  <span th:if="${item.productSize.onFlashSale}"
                        style="text-decoration: line-through; color: #999; font-size: 12px; margin-right: 8px;"
                        th:text="${#numbers.formatCurrency(item.productSize.basePrice)}">
                  </span>
							<span th:text="${#numbers.formatCurrency(item.unitPrice)}"
							      th:style="${item.productSize.onFlashSale ? 'color: #e74c3c; font-weight: 600;' : ''}">
                  </span>
						</div>
					</div>
				</th:block>
				<div th:if="${orderDetail == null || orderDetail.items == null || orderDetail.items.isEmpty()}"
				     style="text-align: center; padding: 40px; color: #999;">
					<p>ChÆ°a cÃ³ mÃ³n nÃ o trong order</p>
					<p style="font-size: 14px;">Nháº¥n nÃºt + Ä‘á»ƒ thÃªm mÃ³n</p>
				</div>
			</div>
			
			<div class="order-summary-edit">
				<div class="summary-row-edit total">
					<span>Tá»•ng cá»™ng:</span>
					<span id="edit-total"
					      th:text="${orderDetail != null && orderDetail.totalPrice != null ? #numbers.formatCurrency(orderDetail.totalPrice) : '0Ä‘'}">0Ä‘</span>
				</div>
			</div>
		</div>
	</div>
	
	<div class="panel-footer">
		<button class="btn btn-secondary" onclick="closeEditOrderPanel()" type="button">Há»§y</button>
		<button class="btn btn-primary" onclick="saveOrderChanges()" type="button" th:method="POST">ğŸ’¾ Cáº­p nháº­t order
		</button>
	</div>
</div>

<!-- Size Selection Modal -->
<div id="size-modal-overlay" class="size-modal-overlay" onclick="closeSizeModal()"></div>
<div id="size-modal" class="size-modal">
	<div class="size-modal-header">
		<h3 id="size-modal-product-name">Chá»n size</h3>
		<button class="size-modal-close" onclick="closeSizeModal()" type="button">&times;</button>
	</div>
	<div class="size-modal-body" id="size-modal-body">
		<!-- Size options will be dynamically populated here -->
	</div>
	<div class="size-modal-footer">
		<button class="btn btn-secondary" onclick="closeSizeModal()" type="button">ÄÃ³ng</button>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script th:src="@{/js/cashier/utils.js}"></script>
<script th:src="@{/js/cashier/reservation.js}"></script>
<script>
    // Initialize clock
    function initializeClock() {
        const $clock = document.getElementById("clock");
        const $date = document.getElementById("date");

        if (!$clock || !$date) {
            console.warn('Clock elements not found');
            return;
        }

        function render() {
            const now = new Date();
            $clock.textContent = now.toLocaleTimeString("vi-VN", {hour12: false});
            $date.textContent = now.toLocaleDateString("vi-VN", {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric",
            });
        }

        render();
        setInterval(render, 1000);
    }

    // Initialize clock when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeClock);
    } else {
        initializeClock();
    }

    document.addEventListener("DOMContentLoaded", function () {
        const toasts = document.querySelectorAll(".toast-container .toast");
        toasts.forEach((toast) => {
            setTimeout(() => {
                toast.style.animation = "slideInRight 0.3s ease reverse";
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        });

        applyFilters();
    });

    // Custom logout confirmation
    function confirmLogout() {
        return confirm("Báº¡n cÃ³ muá»‘n Ä‘Äƒng xuáº¥t khÃ´ng?");
    }

    function applyFilters() {
        const searchInput = document.getElementById('invoice-search');
        const orderTypeSelect = document.getElementById('orderTypeFilter');
        const invoiceCards = document.querySelectorAll('.invoice-card');

        if (!searchInput && !orderTypeSelect) {
            return;
        }

        const selectedType = orderTypeSelect ? orderTypeSelect.value : 'ALL';
        const rawSearch = searchInput ? searchInput.value.trim() : '';
        const normalizedSearch = rawSearch.toLowerCase();

        let visibleCount = 0;

        invoiceCards.forEach((card) => {
            if (!(card instanceof HTMLElement)) {
                return;
            }

            const cardType = (card.getAttribute('data-order-type') || '').toUpperCase();
            const cardIdRaw = card.getAttribute('data-order-id') || '';
            const normalizedId = cardIdRaw.toString().toLowerCase();

            const matchesType = selectedType === 'ALL' || cardType === selectedType;
            const matchesSearch = !normalizedSearch || normalizedId.includes(normalizedSearch);

            if (matchesType && matchesSearch) {
                card.style.display = '';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });

        const noResults = document.getElementById('history-no-results');
        if (noResults) {
            noResults.style.display = visibleCount === 0 ? '' : 'none';
        }
    }

    // Toggle order detail functionality
    function toggleOrderDetail(orderId) {
        const detailSection = document.getElementById(
            "order-detail-" + orderId
        );
        const toggleBtn = document.getElementById("toggle-btn-" + orderId);

        if (
            detailSection.style.display === "none" ||
            detailSection.style.display === ""
        ) {
            // Show detail
            detailSection.style.display = "block";
            toggleBtn.textContent = "ğŸ™ˆ áº¨n";
            toggleBtn.style.backgroundColor = "#6c757d";
        } else {
            // Hide detail
            detailSection.style.display = "none";
            toggleBtn.textContent = "ğŸ“‹ Xem chi tiáº¿t";
            toggleBtn.style.backgroundColor = "#007bff";
        }
    }

      function printReceipt() {
        window.print();
    }
</script>

<script th:src="@{/js/cashier/cashier-dashboard.js}"></script>
<script th:src="@{/js/cashier/utils.js}"></script>
<script th:src="@{/js/cashier/websocket.js}"></script>
<script th:src="@{/js/cashier/table.js}"></script>
<script th:src="@{/js/cashier/reservation.js}"></script>

<!-- Resizable Panel Script -->
<script>
    (function () {
        const resizeHandle = document.getElementById("resize-handle");
        const leftPanel = document.getElementById("left-panel");
        const rightPanel = document.getElementById("right-panel");
        const layout = document.querySelector(".layout");

        let isResizing = false;
        let startX = 0;
        let startWidth = 0;

        if (resizeHandle && leftPanel && rightPanel) {
            resizeHandle.addEventListener("mousedown", function (e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = leftPanel.offsetWidth;

                document.body.classList.add("resizing");
                resizeHandle.classList.add("dragging");

                e.preventDefault();
            });

            document.addEventListener("mousemove", function (e) {
                if (!isResizing) return;

                const deltaX = e.clientX - startX;
                const newWidth = startWidth + deltaX;
                const layoutWidth = layout.offsetWidth;

                // Calculate min and max widths
                const minWidth = 300;
                const maxWidth = layoutWidth - minWidth - 8; // 8px for divider

                // Apply constraints
                if (newWidth >= minWidth && newWidth <= maxWidth) {
                    const widthPercent = (newWidth / layoutWidth) * 100;
                    leftPanel.style.width = widthPercent + "%";
                }

                e.preventDefault();
            });

            document.addEventListener("mouseup", function () {
                if (isResizing) {
                    isResizing = false;
                    document.body.classList.remove("resizing");
                    resizeHandle.classList.remove("dragging");

                    // Save the panel width to localStorage
                    const widthPercent =
                        (leftPanel.offsetWidth / layout.offsetWidth) * 100;
                    localStorage.setItem("cashier-left-panel-width", widthPercent);
                }
            });

            // Restore saved width on page load
            const savedWidth = localStorage.getItem("cashier-left-panel-width");
            if (savedWidth) {
                leftPanel.style.width = savedWidth + "%";
            }
        }
    })();
</script>

<script th:inline="javascript">
    window.addEventListener("DOMContentLoaded", function () {
        var showModal = /*[[${showReservationModal}]]*/ false;
        var showUpdateModal = /*[[${showUpdateModal}]]*/ false;

        if (showModal) {
            setTimeout(function () {
                var modal = document.getElementById("reservation-modal");
                if (modal) {
                    modal.classList.add("show");
                }
            }, 100);
        }

        if (showUpdateModal) {
            setTimeout(function () {
                var modal = document.getElementById("update-reservation-modal");
                if (modal) {
                    modal.classList.add("show");
                    // Äáº£m báº£o modal hiá»ƒn thá»‹ Ä‘Ãºng cÃ¡ch
                    document.body.style.overflow = "hidden";

                    // Format datetime-local input
                    var startTimeInput = document.getElementById("update-start-time");
                    if (startTimeInput && startTimeInput.value) {
                        // Convert the datetime value to proper format for datetime-local input
                        var dateValue = new Date(startTimeInput.value);
                        if (!isNaN(dateValue.getTime())) {
                            startTimeInput.value = formatDateTimeLocal(dateValue);
                        }
                    }
                }
            }, 100);
        }
    });

    function closeUpdateModal() {
        var modal = document.getElementById("update-reservation-modal");
        if (modal) {
            modal.classList.remove("show");
            // Äáº£m báº£o khÃ´ng cÃ³ blur effect nÃ o cÃ²n láº¡i
            document.body.style.overflow = "";
            document.body.style.filter = "";
        }
    }

    // Xá»­ lÃ½ khi click ra ngoÃ i modal Ä‘á»ƒ Ä‘Ã³ng
    document.addEventListener("click", function (event) {
        var updateModal = document.getElementById("update-reservation-modal");
        if (updateModal && event.target === updateModal) {
            closeUpdateModal();
        }
    });

    // Xá»­ lÃ½ khi nháº¥n ESC Ä‘á»ƒ Ä‘Ã³ng modal
    document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
            var updateModal = document.getElementById("update-reservation-modal");
            if (updateModal && updateModal.classList.contains("show")) {
                closeUpdateModal();
            }
        }
    });

    // ==================== KHá»I Táº O NOTIFICATION SYSTEM ====================
    document.addEventListener('DOMContentLoaded', function () {
        initNotificationSystem();

        // LÆ°u cÃ¡c server-side flash messages vÃ o notification history vá»›i metadata
        const toastContainer = document.getElementById('toast-container');
        if (toastContainer) {
            const serverToasts = toastContainer.querySelectorAll('.toast[data-message]');
            serverToasts.forEach(function (toast) {
                const message = toast.getAttribute('data-message');
                const type = toast.getAttribute('data-type') || 'info';

                // Láº¥y metadata tá»« data attributes
                const metadata = {};
                const tableId = toast.getAttribute('data-table-id');
                const reservationId = toast.getAttribute('data-reservation-id');

                if (tableId && tableId !== '') metadata.tableId = tableId;
                if (reservationId && reservationId !== '') metadata.reservationId = reservationId;

                if (message) {
                    saveNotification(message, type, metadata);
                }
            });
        }
    });

    function openEditOrderPanel() {
        const overlay = document.getElementById('edit-order-overlay');
        const panel = document.getElementById('edit-order-panel');

        if (overlay && panel) {
            overlay.classList.add('show');
            panel.classList.add('show');
            document.body.style.overflow = 'hidden';
        }
    }

    function closeEditOrderPanel() {
        const overlay = document.getElementById('edit-order-overlay');
        const panel = document.getElementById('edit-order-panel');

        if (overlay && panel) {
            overlay.classList.remove('show');
            panel.classList.remove('show');
            document.body.style.overflow = '';
        }
    }

    // Menu filtering
    function filterMenu(categoryId) {
        const menuItems = document.querySelectorAll('.menu-item');
        const tabs = document.querySelectorAll('.menu-tab');

        // Update active tab
        tabs.forEach(tab => tab.classList.remove('active'));
        event.target.classList.add('active');

        // Filter items
        menuItems.forEach(item => {
            const itemCategoryId = item.getAttribute('data-category-id');
            if (categoryId === 0 || parseInt(itemCategoryId) === categoryId) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Add item to order from button
    function addItemToOrderFromButton(button) {
        const menuItem = button.closest('.menu-item');
        const itemId = menuItem.getAttribute('data-product-id');
        const itemName = menuItem.getAttribute('data-product-name');
        const itemPrice = parseFloat(menuItem.getAttribute('data-product-price'));

        addItemToOrder(itemId, itemName, itemPrice);
    }

    // Add item to order
    function addItemToOrder(itemId, itemName, itemPrice, sizeId, sizeName, basePrice, isOnSale) {
        const orderItemsContainer = document.getElementById('current-order-items');

        // Remove empty message if exists
        const emptyMessage = orderItemsContainer.querySelector('div[style*="text-align: center"]');
        if (emptyMessage) {
            emptyMessage.remove();
        }

        // Always add new item (khÃ´ng gá»™p vá»›i mÃ³n Ä‘Ã£ cÃ³)
        const newItem = document.createElement('div');
        newItem.className = 'order-edit-item';
        newItem.setAttribute('data-temp-id', 'new-' + Date.now());
        newItem.setAttribute('data-product-id', itemId);
        newItem.setAttribute('data-price', itemPrice);
        newItem.setAttribute('data-base-price', basePrice || itemPrice);
        newItem.setAttribute('data-is-on-sale', isOnSale || false);
        if (sizeId) {
            newItem.setAttribute('data-size-id', sizeId);
        }

        const sizeDisplay = sizeName ? `<div class="order-edit-item-size">Size: ${sizeName}</div>` : '';

        // Build price HTML with strikethrough if on sale
        let priceHTML = '';
        if (isOnSale && basePrice && basePrice > itemPrice) {
            priceHTML = `
            <span style="text-decoration: line-through; color: #999; font-size: 12px; margin-right: 8px;">
              ${formatCurrency(basePrice)}
            </span>
            <span style="color: #e74c3c; font-weight: 600;">
              ${formatCurrency(itemPrice)}
            </span>
          `;
        } else {
            priceHTML = formatCurrency(itemPrice);
        }

        newItem.innerHTML = `
          <div class="order-edit-item-info">
            <div class="order-edit-item-name">${itemName}</div>
            ${sizeDisplay}
            <div class="order-edit-item-note">
              <input type="text"
                     class="item-note-input"
                     placeholder="Ghi chÃº"
                     style="width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
            </div>
          </div>
          <div class="order-edit-item-controls">
            <button class="btn-quantity" onclick="updateQuantityNew(this, -1)">âˆ’</button>
            <span class="quantity">1</span>
            <button class="btn-quantity" onclick="updateQuantityNew(this, 1)">+</button>
            <button class="btn-remove-item" onclick="removeItemNew(this)">ğŸ—‘ï¸</button>
          </div>
          <div class="order-edit-item-price">${priceHTML}</div>
        `;

        orderItemsContainer.appendChild(newItem);

        updateTotalPrice();
        const displayName = itemName + (sizeName ? ' (' + sizeName + ')' : '');
        showToast('ÄÃ£ thÃªm ' + displayName + ' vÃ o order', 'success');
    }

    // Update quantity for new items
    function updateQuantityNew(button, change) {
        const item = button.closest('.order-edit-item');
        const quantityEl = item.querySelector('.quantity');
        let currentQty = parseInt(quantityEl.textContent);
        currentQty += change;

        if (currentQty < 1) {
            currentQty = 1;
        }

        quantityEl.textContent = currentQty;

        // Update price
        const itemPrice = parseFloat(item.getAttribute('data-price'));
        const priceEl = item.querySelector('.order-edit-item-price');
        priceEl.textContent = formatCurrency(itemPrice * currentQty);

        updateTotalPrice();
    }

    // Remove new item
    function removeItemNew(button) {
        if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a mÃ³n nÃ y?')) {
            const item = button.closest('.order-edit-item');
            item.remove();
            const quantityEl = item.querySelector('.quantity');
            quantityEl.textContent = 0;

            // Check if order is empty
            const orderItemsContainer = document.getElementById('current-order-items');
            if (orderItemsContainer.querySelectorAll('.order-edit-item').length === 0) {
                orderItemsContainer.innerHTML = `
              <div style="text-align: center; padding: 40px; color: #999;">
                <p>ChÆ°a cÃ³ mÃ³n nÃ o trong order</p>
                <p style="font-size: 14px;">Nháº¥n nÃºt + Ä‘á»ƒ thÃªm mÃ³n</p>
              </div>
            `;
            }

            updateTotalPrice();
            showToast('ÄÃ£ xÃ³a mÃ³n khá»i order', 'info');
        }
    }

    // Remove existing item from panel
    function removeItemFromPanel(button) {
        if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a mÃ³n nÃ y?')) {
            const item = button.closest('.order-edit-item');

            // Set quantity to 0 instead of removing (to tell backend to delete it)
            const quantityEl = item.querySelector('.quantity');
            quantityEl.textContent = '0';

            // Hide the item visually
            item.style.display = 'none';

            // Check if all visible items are hidden
            const orderItemsContainer = document.getElementById('current-order-items');
            const visibleItems = Array.from(orderItemsContainer.querySelectorAll('.order-edit-item'))
                .filter(i => i.style.display !== 'none');

            if (visibleItems.length === 0) {
                const existingEmpty = orderItemsContainer.querySelector('.empty-order-message');
                if (!existingEmpty) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.className = 'empty-order-message';
                    emptyDiv.style.cssText = 'text-align: center; padding: 40px; color: #999;';
                    emptyDiv.innerHTML = `
                <p>ChÆ°a cÃ³ mÃ³n nÃ o trong order</p>
                <p style="font-size: 14px;">Nháº¥n nÃºt + Ä‘á»ƒ thÃªm mÃ³n</p>
              `;
                    orderItemsContainer.appendChild(emptyDiv);
                }
            }

            updateTotalPrice();
            showToast('ÄÃ£ xÃ³a mÃ³n khá»i order', 'info');
        }
    }

    // Update total price
    function updateTotalPrice() {
        const orderItems = document.querySelectorAll('.order-edit-item');
        let total = 0;

        orderItems.forEach(item => {
            const quantity = parseInt(item.querySelector('.quantity').textContent);
            const price = parseFloat(item.getAttribute('data-price'));
            total += quantity * price;
        });

        document.getElementById('edit-total').textContent = formatCurrency(total);
    }

    // Format currency helper
    function formatCurrency(amount) {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(amount);
    }

    // Open size selection modal
    function openSizeModal(button) {
        const menuItem = button.closest('.menu-item');
        const productId = menuItem.getAttribute('data-product-id');
        const productName = menuItem.getAttribute('data-product-name');

        // Get sizes from hidden div
        const sizesDataDiv = menuItem.querySelector('.product-sizes-data');
        const sizeSpans = sizesDataDiv ? sizesDataDiv.querySelectorAll('span[data-size-id]') : [];

        if (sizeSpans.length === 0) {
            // No sizes available, use default price
            const productPrice = parseFloat(menuItem.getAttribute('data-product-price'));
            addItemToOrder(productId, productName, productPrice, null, null);
            return;
        }

        // Populate modal with sizes
        const modal = document.getElementById('size-modal');
        const overlay = document.getElementById('size-modal-overlay');
        const modalBody = document.getElementById('size-modal-body');
        const modalTitle = document.getElementById('size-modal-product-name');

        modalTitle.textContent = 'Chá»n size - ' + productName;
        modalBody.innerHTML = '';

        sizeSpans.forEach(sizeSpan => {
            const sizeId = sizeSpan.getAttribute('data-size-id');
            const sizeName = sizeSpan.getAttribute('data-size-name');
            const sizePrice = parseFloat(sizeSpan.getAttribute('data-size-price'));
            const basePrice = parseFloat(sizeSpan.getAttribute('data-base-price'));
            const isOnSale = sizeSpan.getAttribute('data-is-on-sale') === 'true';

            const sizeOption = document.createElement('div');
            sizeOption.className = 'size-option';

            // Build price display HTML
            let priceHTML = '';
            if (isOnSale && basePrice > sizePrice) {
                priceHTML = `
              <span style="text-decoration: line-through; color: #999; font-size: 13px; margin-right: 8px;">
                ${formatCurrency(basePrice)}
              </span>
              <span style="color: #e74c3c; font-weight: 600;">
                ${formatCurrency(sizePrice)}
              </span>
            `;
            } else {
                priceHTML = formatCurrency(sizePrice);
            }

            sizeOption.innerHTML = `
            <div class="size-option-info">
              <div class="size-option-name">${sizeName}</div>
              <div class="size-option-price">${priceHTML}</div>
            </div>
            <button class="btn-select-size" onclick="selectSize('${productId}', '${productName}', ${sizePrice}, '${sizeId}', '${sizeName}', ${basePrice}, ${isOnSale})">
              Chá»n
            </button>
          `;
            modalBody.appendChild(sizeOption);
        });

        // Show modal
        overlay.classList.add('show');
        modal.classList.add('show');
    }

    // Close size modal
    function closeSizeModal() {
        const modal = document.getElementById('size-modal');
        const overlay = document.getElementById('size-modal-overlay');
        overlay.classList.remove('show');
        modal.classList.remove('show');
    }

    // Select size and add to order
    function selectSize(productId, productName, price, sizeId, sizeName, basePrice, isOnSale) {
        addItemToOrder(productId, productName, price, sizeId, sizeName, basePrice, isOnSale);
        closeSizeModal();
    }

    // Update quantity
    function updateQuantity(itemId, change) {
        const quantityElement = event.target.parentElement.querySelector('.quantity');
        let currentQty = parseInt(quantityElement.textContent);
        currentQty += change;

        if (currentQty < 1) {
            currentQty = 1;
        }

        quantityElement.textContent = currentQty;
        // TODO: Update total calculation
        console.log('Updated quantity for item:', itemId, 'to:', currentQty);
    }

    // Save order changes
    function saveOrderChanges() {
        if (!confirm('XÃ¡c nháº­n cáº­p nháº­t order?')) {
            return;
        }

        // Get all order items
        const orderItems = [];
        const items = document.querySelectorAll('.order-edit-item');

        items.forEach(item => {
            const productId = item.getAttribute('data-product-id');
            const productName = item.querySelector('.order-edit-item-name').textContent;
            const quantityElement = item.querySelector('.quantity');
            const quantity = quantityElement ? parseInt(quantityElement.textContent) : 0;
            const price = parseFloat(item.getAttribute('data-price'));
            const sizeId = item.getAttribute('data-size-id');
            const noteInput = item.querySelector('.item-note-input');
            const note = noteInput ? noteInput.value.trim() : '';

            // Kiá»ƒm tra xem lÃ  mÃ³n cÅ© hay mÃ³n má»›i
            const isOldItem = item.hasAttribute('data-item-id');
            const isNewItem = item.hasAttribute('data-temp-id');

            // Check náº¿u note thay Ä‘á»•i (cho mÃ³n cÅ©)
            const originalNote = item.getAttribute('data-original-note') || '';
            const noteChanged = isOldItem && (note !== originalNote);

            // MÃ³n Má»šI (cÃ³ data-temp-id) vá»›i quantity > 0
            // MÃ³n CÅ¨ bá»‹ XÃ“A (cÃ³ data-item-id vÃ  quantity = 0)
            // MÃ³n CÅ¨ cÃ³ NOTE THAY Äá»”I (Ä‘á»ƒ cáº­p nháº­t note)
            const shouldSend = (isNewItem && quantity > 0) || (isOldItem && quantity === 0) || noteChanged;

            if (productId && !isNaN(quantity) && shouldSend) {
                const orderItem = {
                    productId: productId,
                    productName: productName,
                    quantity: quantity,
                    price: price,
                    note: note || ''  // LuÃ´n gá»­i note (ká»ƒ cáº£ khi rá»—ng)
                };

                // ThÃªm orderItemId náº¿u lÃ  mÃ³n cÅ© (Ä‘á»ƒ backend xÃ³a Ä‘Ãºng mÃ³n)
                if (isOldItem) {
                    const itemId = item.getAttribute('data-item-id');
                    if (itemId) {
                        orderItem.orderItemId = parseInt(itemId);
                    }
                }

                if (sizeId) {
                    orderItem.sizeId = sizeId;
                }

                orderItems.push(orderItem);
            }
        });

        // Get table ID from URL or hidden field
        const tableId = /*[[${selectedTableId}]]*/ null;

        if (!tableId) {
            showToast('Lá»—i: KhÃ´ng tÃ¬m tháº¥y thÃ´ng tin bÃ n', 'error');
            return;
        }

        // Create form and submit
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/pizzario/cashier/tables/' + tableId + '/order/update';

        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = /*[[@{${_csrf.parameterName}}]]*/ '_csrf';
        csrfInput.value = /*[[@{${_csrf.token}}]]*/ '';

        form.appendChild(csrfInput);

        // Add items as JSON
        const itemsInput = document.createElement('input');
        itemsInput.type = 'hidden';
        itemsInput.name = 'items';
        itemsInput.value = JSON.stringify(orderItems);
        form.appendChild(itemsInput);

        document.body.appendChild(form);
        form.submit();
    }

    // Close panel on ESC key
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            const panel = document.getElementById('edit-order-panel');
            if (panel && panel.classList.contains('show')) {
                closeEditOrderPanel();
            }
        }
    });
</script>
</body>
</html>
