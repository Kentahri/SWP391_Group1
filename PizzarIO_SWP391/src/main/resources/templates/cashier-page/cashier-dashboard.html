<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Cashier Dashboard - Table Management</title>
	<link rel="stylesheet" th:href="@{/css/cashier-dashboard.css}">
</head>
<body>
<div class="dashboard-container">
	<!-- Top bar -->
	<header class="topbar">
		<div class="brand">ğŸ• PizzarIO</div>
		<div>TÃªn: <p th:text="${staff.name}"></p></div>
		<div>
			<div id="clock" class="clock">--:--:--</div>
			<div id="date" class="date">--/--/----</div>
		</div>
		<div class="actions">
			<button class="btn"><a th:href="@{/cashier/reservations/upcoming}">Xem Ä‘Æ¡n hÃ ng Ä‘áº·t trÆ°á»›c</a></button>
			<button class="btn action" type="button">Táº¡o má»›i Ä‘Æ¡n hÃ ng</button>
			<button class="btn action" type="button">Xem lá»‹ch sá»­ hÃ³a Ä‘Æ¡n</button>
			<form th:action="@{/logout}" method="post">
				<input type="hidden"
				       th:if="${_csrf != null}"
				       th:name="${_csrf.parameterName}"
				       th:value="${_csrf.token}"/>
				<button type="submit" class="btn-logout" onclick="alert('Báº¡n cÃ³ muá»‘n Ä‘Äƒng xuáº¥t khÃ´ng?')">Logout</button>
			</form>
		</div>
	</header>
	<div class="horizontal-divider"></div>
	
	<div class="layout">
		<!-- Left: Table manager -->
		<section class="panel left">
			<div class="section-title">Quáº£n lÃ½ bÃ n</div>
			<div class="panel-header">
				<span class="icon">ğŸª‘</span>
				<span class="title">Table map</span>
			</div>
			
			<div class="table-grid" id="table-grid">
				<a th:each="table : ${tables}"
				   th:id="'table-' + ${table.id}"
				   th:class="'table-card ' + ${table.tableStatus.toString().toLowerCase()} + ${selectedTableId != null && selectedTableId == table.id ? ' selected' : ''}"
				   th:href="@{/cashier/tables/{id}/order(id=${table.id})}"
				   th:attr="data-id=${table.id},
				            data-status=${table.tableStatus},
				            data-capacity=${table.capacity}"
				   style="text-decoration: none; color: inherit; cursor: pointer;">
					<div class="table-dot"
					     th:classappend="${table.tableStatus.toString().toLowerCase() == 'waiting_payment' ? ' show' : ''}"></div>
					<div class="table-number">BÃ n [[${table.id}]]</div>
					<div class="table-status-text"
					     th:text="${table.tableStatus == 'AVAILABLE' ? 'Trá»‘ng' : (table.tableStatus == 'OCCUPIED' ? 'CÃ³ khÃ¡ch' : (table.tableStatus == 'WAITING_PAYMENT' ? 'Chá» thanh toÃ¡n' : 'ÄÃ£ Ä‘áº·t trÆ°á»›c'))}">
						Trá»‘ng
					</div>
					<div class="table-note" th:if="${table.tableStatus == 'WAITING_PAYMENT'}">Tiá»n máº·t</div>
					<div class="table-capacity" th:if="${table.tableStatus == 'RESERVED'}">[[${table.capacity}]] ngÆ°á»i
					</div>
				</a>
			</div>
			
			<div class="legend">
				<div class="legend-title">ChÃº thÃ­ch:</div>
				<div class="legend-items">
					<div class="legend-item"><span class="box avail"></span><span>BÃ n trá»‘ng</span></div>
					<div class="legend-item"><span class="box occ"></span><span>Äang cÃ³ khÃ¡ch</span></div>
					<div class="legend-item"><span class="box wait"></span><span>Chá» thanh toÃ¡n</span></div>
					<div class="legend-item"><span class="box res"></span><span>ÄÃ£ Ä‘áº·t trÆ°á»›c</span></div>
				</div>
			</div>
		</section>
		
		<!-- Right: Table details -->
		<section class="panel right">
			<div class="section-title" id="right-panel-title">
				<span th:text="${upcomingReservations != null ? 'Danh sÃ¡ch Ä‘áº·t bÃ n sáº¯p tá»›i' : (tableReservations != null ? 'ÄÆ¡n Ä‘áº·t trÆ°á»›c - BÃ n ' + selectedTableId : 'ÄÆ¡n bÃ n chi tiáº¿t')}">ÄÆ¡n bÃ n chi tiáº¿t</span>
			</div>
			
			<!-- Table Detail View (default - no table selected) -->
			<div id="table-detail" class="table-detail" th:if="${orderDetail == null && selectedTableId == null && upcomingReservations == null && tableReservations == null}">
				<div class="placeholder">Chá»n 1 bÃ n Ä‘á»ƒ xem chi tiáº¿t</div>
			</div>
			
			<!-- Empty Table View (table selected but no order) -->
			<div th:if="${selectedTableId != null && orderDetail == null && upcomingReservations == null && tableReservations == null}" class="table-detail">
				<div class="detail-card">
					<div class="detail-row"><strong>BÃ n sá»‘:</strong> <span th:text="${selectedTableId}">â€”</span></div>
					
					<div style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
						<button class="btn-reserve" th:onclick="'openReservationModal(' + ${selectedTableId} + ')'">
							ğŸ“… Äáº·t trÆ°á»›c bÃ n nÃ y
						</button>
						<a th:href="@{/cashier/tables/{tableId}/reservations(tableId=${selectedTableId})}" class="btn-view-reservations">
							ğŸ“‹ Xem Ä‘Æ¡n Ä‘áº·t trÆ°á»›c
						</a>
					</div>
				</div>
			</div>
			
			<!-- Order Detail View (when table is selected and has order) -->
			<div th:if="${orderDetail != null}" class="table-detail">
				<div class="detail-card">
					<div class="detail-row"><strong>BÃ n sá»‘:</strong> <span th:text="${selectedTableId}">â€”</span></div>
					<div class="detail-row"><strong>Sá»‘ ngÆ°á»i tá»‘i Ä‘a:</strong> <span th:text="${tableCapacity}">â€”</span></div>
				</div>
				<div class="order-detail-card">
					<div class="order-header">
						<span th:class="'order-status ' + ${orderDetail.orderStatus.toString().toLowerCase()}" 
						      th:text="${orderDetail.orderStatus == 'PREPARING' ? 'Äang chuáº©n bá»‹' : (orderDetail.orderStatus == 'SERVED' ? 'ÄÃ£ phá»¥c vá»¥' : (orderDetail.orderStatus == 'COMPLETED' ? 'HoÃ n thÃ nh' : orderDetail.orderStatus))}">
						</span>
					</div>
					
					<div class="order-meta">
						<div class="meta-row">
							<span class="meta-label">MÃ£ Ä‘Æ¡n:</span>
							<span class="meta-value">#<span th:text="${orderDetail.orderId}">â€”</span></span>
						</div>
						<div class="meta-row">
							<span class="meta-label">Tráº¡ng thÃ¡i thanh toÃ¡n:</span>
							<span th:class="'meta-value payment-' + ${orderDetail.paymentStatus.toString().toLowerCase()}" 
							      th:text="${orderDetail.paymentStatus == 'UNPAID' ? 'ChÆ°a thanh toÃ¡n' : (orderDetail.paymentStatus == 'PAID' ? 'ÄÃ£ thanh toÃ¡n' : 'Äang xá»­ lÃ½')}">
							</span>
						</div>
						<div class="meta-row" th:if="${orderDetail.paymentMethod != null}">
							<span class="meta-label">PhÆ°Æ¡ng thá»©c:</span>
							<span class="meta-value" th:text="${orderDetail.paymentMethod == 'CASH' ? 'Tiá»n máº·t' : (orderDetail.paymentMethod == 'QR' ? 'QR Code' : 'Tháº» tÃ­n dá»¥ng')}"></span>
						</div>
					</div>

					<div class="order-items-section">
						<div class="section-header-small">
							<span>MÃ³n Ä‘Ã£ gá»i</span>
							<span class="item-count" th:text="${#lists.isEmpty(orderDetail.items) ? '0' : #aggregates.sum(orderDetail.items.![quantity])} + ' mÃ³n'">0 mÃ³n</span>
						</div>
						<div class="order-items-list">
							<div th:if="${#lists.isEmpty(orderDetail.items)}" class="no-items">ChÆ°a cÃ³ mÃ³n nÃ o</div>
							<div th:each="item : ${orderDetail.items}" class="order-item">
								<div class="order-item-info">
									<div class="item-name" th:text="${item.productName}">â€”</div>
									<div class="item-detail">
										<span class="item-quantity">x<span th:text="${item.quantity}">1</span></span>
										<span class="item-price" th:text="${#numbers.formatCurrency(item.unitPrice)}">0Ä‘</span>
									</div>
									<div th:if="${item.note != null && !#strings.isEmpty(item.note)}" class="item-note">ğŸ“ <span th:text="${item.note}"></span></div>
								</div>
								<div class="item-total" th:text="${#numbers.formatCurrency(item.totalPrice)}">0Ä‘</div>
							</div>
						</div>
					</div>

					<div class="order-summary">
						<div th:if="${orderDetail.voucherCode != null}" class="summary-row">
							<span>Voucher:</span>
							<span class="voucher-code" th:text="${orderDetail.voucherCode}">â€”</span>
						</div>
						<div th:if="${orderDetail.discountAmount != null && orderDetail.discountAmount > 0}" class="summary-row discount">
							<span>Giáº£m giÃ¡:</span>
							<span th:text="'-' + ${#numbers.formatCurrency(orderDetail.discountAmount)}">-0Ä‘</span>
						</div>
						<div class="summary-row total">
							<span>Tá»•ng cá»™ng:</span>
							<span class="total-amount" th:text="${#numbers.formatCurrency(orderDetail.totalPrice)}">0Ä‘</span>
						</div>
					</div>

					<div th:if="${orderDetail.note != null && !#strings.isEmpty(orderDetail.note)}" class="order-note">
						<strong>Ghi chÃº:</strong> <span th:text="${orderDetail.note}"></span>
					</div>
				</div>
				
				<div style="margin-top: 12px;">
					<a th:href="@{/cashier/tables/{tableId}/reservations(tableId=${selectedTableId})}" class="btn-view-reservations">
						ğŸ“‹ Xem Ä‘Æ¡n Ä‘áº·t trÆ°á»›c
					</a>
				</div>
			</div>
			
			<!-- Upcoming Reservations View -->
			<div th:if="${upcomingReservations != null}" class="reservation-list">
				<div class="reservation-header">
					<a th:href="@{/cashier}" class="btn-back">â† Quay láº¡i</a>
				</div>
				
				<!-- Search Form - chá»‰ hiá»‡n trong upcoming reservations -->
				<div class="search-container" style="margin: 16px 0;">
					<form th:action="@{/cashier/reservations/upcoming}" method="get" style="display: flex; gap: 8px;">
						<input type="text" 
						       name="search" 
						       th:value="${searchKeyword}" 
						       placeholder="TÃ¬m theo tÃªn, SÄT, hoáº·c sá»‘ bÃ n..." 
						       class="search-input"
						       style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
						<button type="submit" class="btn btn-primary" style="padding: 10px 20px; white-space: nowrap;">ğŸ” TÃ¬m kiáº¿m</button>
						<a th:href="@{/cashier/reservations/upcoming}" class="btn btn-secondary" style="padding: 10px 20px; text-decoration: none; display: inline-block;">â†» XÃ³a lá»c</a>
					</form>
				</div>
				
				<div class="reservation-items">
					<div th:if="${#lists.isEmpty(upcomingReservations)}" class="no-reservations">
						<div class="no-reservations-icon">ğŸ“…</div>
						<div class="no-reservations-text">ChÆ°a cÃ³ Ä‘Æ¡n Ä‘áº·t bÃ n nÃ o</div>
					</div>
					
					<div th:each="reservation : ${upcomingReservations}" class="reservation-card">
					<div class="reservation-card-header">
						<div class="reservation-table-name">
							<span style="font-weight: 700; color: #2c3e50;" th:text="${reservation.tableName}">BÃ n #</span>
							<span style="font-size: 12px; color: #6c757d; margin-left: 8px;">| ÄÆ¡n #<span th:text="${reservation.id}">â€”</span></span>
						</div>
						<span th:class="'reservation-status ' + ${reservation.status.toString().toLowerCase()}" 
						      th:text="${reservation.status == 'CONFIRMED' ? 'ÄÃ£ xÃ¡c nháº­n' : 
						                (reservation.status == 'ARRIVED' ? 'ÄÃ£ Ä‘áº¿n' : 
						                (reservation.status == 'CANCELED' ? 'ÄÃ£ há»§y' : 'KhÃ´ng Ä‘áº¿n'))}">
						</span>
					</div>
						
						<div class="reservation-time">
							ğŸ• Thá»i gian: <span th:text="${#temporals.format(reservation.startTime, 'EEE, dd MMM yyyy HH:mm')}">â€”</span>
						</div>
						
						<div class="reservation-info">
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¤ KhÃ¡ch hÃ ng:</span>
								<span class="reservation-info-value" th:text="${reservation.customerName}">â€”</span>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</span>
								<span class="reservation-info-value" th:text="${reservation.customerPhone}">â€”</span>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¥ Sá»‘ khÃ¡ch:</span>
								<span class="reservation-info-value" th:text="${reservation.capacityExpected + ' ngÆ°á»i'}">â€” ngÆ°á»i</span>
							</div>
							<div th:if="${reservation.note != null && !#strings.isEmpty(reservation.note)}" class="reservation-info-row">
								<span class="reservation-info-label">ğŸ“ Ghi chÃº:</span>
								<span class="reservation-info-value" th:text="${reservation.note}">â€”</span>
							</div>
						</div>
						
					<div th:if="${reservation.status.toString() == 'CONFIRMED'}" class="reservation-actions" style="display: flex; flex-direction: column; gap: 8px;">
						<!-- NÃºt má»Ÿ bÃ n cho khÃ¡ch (nÃºt chÃ­nh) -->
						<form th:action="@{/cashier/reservations/{id}/open(id=${reservation.id})}" method="post" 
						      onsubmit="return confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ Ä‘áº¿n vÃ  má»Ÿ bÃ n?');">
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
							<input type="hidden" name="returnUrl" value="/cashier/reservations/upcoming"/>
							<button type="submit" class="btn-open-table" 
							        style="width: 100%; padding: 12px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 15px;">
								ğŸ”“ Má»Ÿ bÃ n cho khÃ¡ch
							</button>
						</form>
						
						<!-- CÃ¡c nÃºt phá»¥ -->
						<div style="display: flex; gap: 8px;">
							<a th:href="@{/cashier/reservations/{id}/edit(id=${reservation.id}, returnUrl='/cashier/reservations/upcoming')}" 
							   class="btn-edit-reservation"
							   style="flex: 1; text-align: center; padding: 10px; background-color: #4CAF50; color: white; border-radius: 4px; text-decoration: none; border: none; cursor: pointer;">
								âœï¸ Sá»­a
							</a>
							<form th:action="@{/cashier/reservations/{id}/delete(id=${reservation.id})}" method="post" 
							      onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n há»§y Ä‘áº·t bÃ n nÃ y?');"
							      style="flex: 1;">
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
								<input type="hidden" name="returnUrl" value="/cashier/reservations/upcoming"/>
								<button type="submit" class="btn-cancel-reservation" style="width: 100%;">âŒ Há»§y Ä‘áº·t bÃ n</button>
							</form>
						</div>
					</div>
					</div>
				</div>
			</div>
			
			<!-- Table Reservations View -->
			<div th:if="${tableReservations != null}" class="reservation-list">
				<div class="detail-card" style="margin-bottom: 16px;">
					<div class="reservation-header">
						<a th:href="@{/cashier/tables/{id}/order(id=${selectedTableId})}" class="btn-back">
							â† Quay láº¡i bÃ n <span th:text="${selectedTableId}">â€”</span>
						</a>
					</div>
				</div>
				<div class="reservation-items">
					<div th:if="${#lists.isEmpty(tableReservations)}" class="no-reservations">
						<div class="no-reservations-icon">ğŸ“…</div>
						<div class="no-reservations-text">ChÆ°a cÃ³ Ä‘Æ¡n Ä‘áº·t bÃ n nÃ o</div>
					</div>
					
					<div th:each="reservation : ${tableReservations}" class="reservation-card">
					<div class="reservation-card-header">
						<div class="reservation-table-name">
							<span style="font-weight: 700; color: #2c3e50;">BÃ n <span th:text="${reservation.tableId}">#</span></span>
							<span style="font-size: 12px; color: #6c757d; margin-left: 8px;">| ÄÆ¡n #<span th:text="${reservation.id}">â€”</span></span>
						</div>
						<span th:class="'reservation-status ' + ${reservation.status.toString().toLowerCase()}" 
						      th:text="${reservation.status == 'CONFIRMED' ? 'ÄÃ£ xÃ¡c nháº­n' : 
						                (reservation.status == 'ARRIVED' ? 'ÄÃ£ Ä‘áº¿n' : 
						                (reservation.status == 'CANCELED' ? 'ÄÃ£ há»§y' : 'KhÃ´ng Ä‘áº¿n'))}">
						</span>
					</div>
						
						<div class="reservation-time">
							ğŸ• <span th:text="${#temporals.format(reservation.startTime, 'EEE, dd MMM yyyy HH:mm')}">â€”</span>
						</div>
						
						<div class="reservation-info">
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¤ KhÃ¡ch hÃ ng:</span>
								<span class="reservation-info-value" th:text="${reservation.customerName}">â€”</span>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ“ Sá»‘ Ä‘iá»‡n thoáº¡i:</span>
								<span class="reservation-info-value" th:text="${reservation.customerPhone}">â€”</span>
							</div>
							<div class="reservation-info-row">
								<span class="reservation-info-label">ğŸ‘¥ Sá»‘ khÃ¡ch:</span>
								<span class="reservation-info-value" th:text="${reservation.capacityExpected + ' ngÆ°á»i'}">â€” ngÆ°á»i</span>
							</div>
							<div th:if="${reservation.note != null && !#strings.isEmpty(reservation.note)}" class="reservation-info-row">
								<span class="reservation-info-label">ğŸ“ Ghi chÃº:</span>
								<span class="reservation-info-value" th:text="${reservation.note}">â€”</span>
							</div>
						</div>
						
					<div th:if="${reservation.status.toString() == 'CONFIRMED'}" class="reservation-actions" style="display: flex; flex-direction: column; gap: 8px;">
						<!-- NÃºt má»Ÿ bÃ n cho khÃ¡ch (nÃºt chÃ­nh) -->
						<form th:action="@{/cashier/reservations/{id}/open(id=${reservation.id})}" method="post" 
						      onsubmit="return confirm('XÃ¡c nháº­n khÃ¡ch Ä‘Ã£ Ä‘áº¿n vÃ  má»Ÿ bÃ n?');">
							<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
							<input type="hidden" name="returnUrl" th:value="'/cashier/tables/' + ${selectedTableId} + '/reservations'"/>
							<button type="submit" class="btn-open-table" 
							        style="width: 100%; padding: 12px; background-color: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 15px;">
								ğŸ”“ Má»Ÿ bÃ n cho khÃ¡ch
							</button>
						</form>
						
						<!-- CÃ¡c nÃºt phá»¥ -->
						<div style="display: flex; gap: 8px;">
							<a th:href="@{/cashier/reservations/{id}/edit(id=${reservation.id}, returnUrl='/cashier/tables/' + ${selectedTableId} + '/reservations')}" 
							   class="btn-edit-reservation"
							   style="flex: 1; text-align: center; padding: 10px; background-color: #4CAF50; color: white; border-radius: 4px; text-decoration: none; border: none; cursor: pointer;">
								âœï¸ Sá»­a
							</a>
							<form th:action="@{/cashier/reservations/{id}/delete(id=${reservation.id})}" method="post" 
							      onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n há»§y Ä‘áº·t bÃ n nÃ y?');"
							      style="flex: 1;">
								<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
								<input type="hidden" name="returnUrl" th:value="'/cashier/tables/' + ${selectedTableId} + '/reservations'"/>
								<button type="submit" class="btn-cancel-reservation" style="width: 100%;">âŒ Há»§y Ä‘áº·t bÃ n</button>
							</form>
						</div>
					</div>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>

<div class="toast-container" id="toast-container">
	<!-- Flash messages tá»« redirect (chá»‰ hiá»ƒn thá»‹ náº¿u khÃ´ng pháº£i lá»—i validation modal) -->
	<div th:if="${successMessage}" class="toast success" style="display: block;">
		<span th:text="${successMessage}"></span>
	</div>
	<div th:if="${errorMessage != null and (showReservationModal == null or !showReservationModal)}" class="toast error" style="display: block;">
		<span th:text="${errorMessage}"></span>
	</div>
</div>

<!-- Modal Toast Container cho errors trong modal -->
<div class="modal-toast-container" id="modal-toast-container"></div>


<!-- Server Status Indicator - GÃ³c trÃ¡i dÆ°á»›i -->
<div class="server-status-container">
	<div id="server-status"><button class="btn" onclick="checkServerConnection()">Check connect to server</button></div>
</div>

<!-- Modal Ä‘áº·t bÃ n -->
<div id="reservation-modal" class="modal">
	<div class="modal-content">
		<div class="modal-header">
			<h2>Äáº·t trÆ°á»›c bÃ n</h2>
			<span class="modal-close" onclick="closeReservationModal()">&times;</span>
		</div>
		<form id="reservation-form" th:action="@{/cashier/reservations}" method="post" th:object="${reservationCreateDTO}">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
			<input type="hidden" id="table-id-hidden" th:field="*{tableId}"/>
			
			<div class="form-group">
				<label for="table-id-display">BÃ n sá»‘</label>
				<input type="text" id="table-id-display" readonly class="form-control" th:field="*{tableId}">
			</div>
			
			<div class="form-group">
				<label for="customer-name">TÃªn khÃ¡ch hÃ ng <span class="required">*</span></label>
				<input type="text" id="customer-name" th:field="*{customerName}" required 
				       th:classappend="${#fields.hasErrors('customerName')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('customerName')}" th:errors="*{customerName}"></div>
			</div>
			
			<div class="form-group">
				<label for="customer-phone">Sá»‘ Ä‘iá»‡n thoáº¡i <span class="required">*</span></label>
				<input type="tel" id="customer-phone" th:field="*{customerPhone}" required 
				       th:classappend="${#fields.hasErrors('customerPhone')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('customerPhone')}" th:errors="*{customerPhone}"></div>
			</div>
			
			<div class="form-group">
				<label for="customer-capacity">Sá»‘ lÆ°á»£ng dá»± kiáº¿n <span class="required">*</span></label>
				<input type="number" id="customer-capacity" th:field="*{capacityExpected}" required 
				       th:classappend="${#fields.hasErrors('capacityExpected')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('capacityExpected')}" th:errors="*{capacityExpected}"></div>
			</div>
			
			<div class="form-row">
				<div class="form-group half">
					<label for="start-time">Thá»i gian báº¯t Ä‘áº§u <span class="required">*</span></label>
					<input type="datetime-local" id="start-time" th:field="*{startTime}" required 
					       th:classappend="${#fields.hasErrors('startTime')} ? 'is-invalid' : ''"
					       class="form-control">
					<div class="invalid-feedback" th:if="${#fields.hasErrors('startTime')}" th:errors="*{startTime}"></div>
				</div>
			</div>
			
			<div class="form-group">
				<label for="note">Ghi chÃº (tÃ¹y chá»n)</label>
				<textarea id="note" th:field="*{note}" 
				          th:classappend="${#fields.hasErrors('note')} ? 'is-invalid' : ''"
				          class="form-control" rows="3"
				          placeholder="Nháº­p ghi chÃº náº¿u cÃ³..."></textarea>
				<div class="invalid-feedback" th:if="${#fields.hasErrors('note')}" th:errors="*{note}"></div>
			</div>
			
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" onclick="closeReservationModal()">Há»§y</button>
				<button type="submit" class="btn btn-primary">XÃ¡c nháº­n Ä‘áº·t bÃ n</button>
			</div>
		</form>
	</div>
</div>

<!-- Modal cáº­p nháº­t Ä‘áº·t bÃ n -->
<div id="update-reservation-modal" class="modal" th:if="${reservationUpdateDTO != null}">
	<div class="modal-content">
		<div class="modal-header">
			<h2>Cáº­p nháº­t Ä‘áº·t bÃ n</h2>
			<span class="modal-close" onclick="closeUpdateModal()">&times;</span>
		</div>
		<form id="update-reservation-form" 
		      th:action="@{/cashier/reservations/{id}/update(id=${reservationUpdateDTO.id})}" 
		      method="post" 
		      th:object="${reservationUpdateDTO}">
			<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
			<input type="hidden" name="returnUrl" th:value="${returnUrl}"/>
			
			<div class="form-group">
				<label for="update-table-id">BÃ n sá»‘</label>
				<input type="text" id="update-table-id" readonly class="form-control" th:value="'BÃ n ' + ${reservationUpdateDTO.tableId}">
			</div>
			
			<div class="form-group">
				<label for="update-customer-name">TÃªn khÃ¡ch hÃ ng <span class="required">*</span></label>
				<input type="text" id="update-customer-name" th:field="*{customerName}" required 
				       th:classappend="${#fields.hasErrors('customerName')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('customerName')}" th:errors="*{customerName}"></div>
			</div>
			
			<div class="form-group">
				<label for="update-customer-phone">Sá»‘ Ä‘iá»‡n thoáº¡i <span class="required">*</span></label>
				<input type="tel" id="update-customer-phone" th:field="*{customerPhone}" required 
				       th:classappend="${#fields.hasErrors('customerPhone')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('customerPhone')}" th:errors="*{customerPhone}"></div>
			</div>
			
			<div class="form-group">
				<label for="update-customer-capacity">Sá»‘ lÆ°á»£ng dá»± kiáº¿n <span class="required">*</span></label>
				<input type="number" id="update-customer-capacity" th:field="*{capacityExpected}" required 
				       th:classappend="${#fields.hasErrors('capacityExpected')} ? 'is-invalid' : ''"
				       class="form-control">
				<div class="invalid-feedback" th:if="${#fields.hasErrors('capacityExpected')}" th:errors="*{capacityExpected}"></div>
			</div>
			
			<div class="form-row">
				<div class="form-group half">
					<label for="update-start-time">Thá»i gian báº¯t Ä‘áº§u <span class="required">*</span></label>
					<input type="datetime-local" id="update-start-time" th:field="*{startTime}" required 
					       th:classappend="${#fields.hasErrors('startTime')} ? 'is-invalid' : ''"
					       class="form-control">
					<div class="invalid-feedback" th:if="${#fields.hasErrors('startTime')}" th:errors="*{startTime}"></div>
				</div>
			</div>
			
			<div class="form-group">
				<label for="update-note">Ghi chÃº (tÃ¹y chá»n)</label>
				<textarea id="update-note" th:field="*{note}" 
				          th:classappend="${#fields.hasErrors('note')} ? 'is-invalid' : ''"
				          class="form-control" rows="3"
				          placeholder="Nháº­p ghi chÃº náº¿u cÃ³..."></textarea>
				<div class="invalid-feedback" th:if="${#fields.hasErrors('note')}" th:errors="*{note}"></div>
			</div>
			
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" onclick="closeUpdateModal()">Há»§y</button>
				<button type="submit" class="btn btn-primary">Cáº­p nháº­t</button>
			</div>
		</form>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    const $clock = document.getElementById('clock');
    const $date = document.getElementById('date');

    function render() {
        const now = new Date();
        $clock.textContent = now.toLocaleTimeString('vi-VN', {hour12: false});
        $date.textContent = now.toLocaleDateString('vi-VN',
            {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});
    }
    
    render();
    setInterval(render, 1000);

    document.addEventListener('DOMContentLoaded', function() {
        const toasts = document.querySelectorAll('.toast-container .toast');
        toasts.forEach(toast => {
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        });
    });
</script>

<script th:src="@{/js/cashier/utils.js}"></script>
<script th:src="@{/js/cashier/websocket.js}"></script>
<script th:src="@{/js/cashier/table.js}"></script>
<script th:src="@{/js/cashier/reservation.js}"></script>

<script th:inline="javascript">
    window.addEventListener('DOMContentLoaded', function() {
        var showModal = /*[[${showReservationModal}]]*/ false;
        var showUpdateModal = /*[[${showUpdateModal}]]*/ false;
        
        if (showModal) {
            setTimeout(function() {
                var modal = document.getElementById('reservation-modal');
                if (modal) {
                    modal.classList.add('show');
                }
            }, 100);
        }
        
        if (showUpdateModal) {
            setTimeout(function() {
                var modal = document.getElementById('update-reservation-modal');
                if (modal) {
                    modal.classList.add('show');
                }
            }, 100);
        }
    });
    
    function closeUpdateModal() {
        var modal = document.getElementById('update-reservation-modal');
        if (modal) {
            modal.classList.remove('show');
        }
    }
</script>

</body>
</html>


