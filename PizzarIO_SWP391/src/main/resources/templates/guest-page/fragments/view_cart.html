<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>

<!-- =============================================================== -->
<!-- FRAGMENT CHO GI·ªé H√ÄNG (CART)                                     -->
<!-- =============================================================== -->
<div th:fragment="cart-view" class="cart-section">
    <h2>My Cart üõí</h2>
    <div class="items-list" id="cartList">
        <th:block th:if="${#lists.isEmpty(cartItems)}">
            <p class="empty-message">Your cart is empty.</p>
        </th:block>
        <div class="cart-item" th:each="item : ${cartItems}">
            <div class="item-details">
                <div class="name" th:text="${item.productName}">Product Name</div>
                <div class="price" th:text="${#numbers.formatCurrency(item.totalPrice)}">0ƒë</div>
                <form class="ajax-form" th:action="@{/guest/cart/update}" method="post" id="sizeForm">
                    <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                    <input type="hidden" name="tableId" th:value="${tableId}"/>
                    <input type="hidden" name="productId" th:value="${item.productId}"/>
                    <input type="hidden" name="quantity" th:value="${item.quantity}"/>
                    <input type="hidden" name="note" th:value="${item.note}"/>

<!--                    <label for="sizeSelect"><strong>Ch·ªçn k√≠ch c·ª°:</strong></label>-->
                    <select id="sizeSelect" name="productSizeId"
                            style="display:block; margin-top:6px; padding:6px; border-radius:4px; width:100%;"
                            onchange="this.form.requestSubmit()">
                        <option th:each="ps : ${item.productSizes}"
                                th:value="${ps.id}"
                                th:selected="${ps.id == item.productSize.id}"
                                th:text="${ps.size.sizeName}">
                        </option>
                    </select>
                </form>
                <div class="note" th:text="${item.note}"></div>
            </div>
            <div class="item-qty">
                <form class="ajax-form" th:action="@{/guest/cart/update}" method="post">
                    <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                    <input type="hidden" name="tableId" th:value="${tableId}"/>
                    <input type="hidden" name="productId" th:value="${item.productId}"/>
                    <input type="hidden" name="quantity" th:value="${item.quantity - 1}"/>
                    <input type="hidden" name="productSizeId" th:value="${item.productSize.id}"/>
                    <button type="submit">-</button>
                </form>
                <span th:text="${item.quantity}">1</span>
                <form class="ajax-form" th:action="@{/guest/cart/update}" method="post">
                    <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                    <input type="hidden" name="tableId" th:value="${tableId}"/>
                    <input type="hidden" name="productId" th:value="${item.productId}"/>
                    <input type="hidden" name="quantity" th:value="${item.quantity + 1}"/>
                    <input type="hidden" name="productSizeId" th:value="${item.productSize.id}"/>
                    <button type="submit">+</button>
                </form>
            </div>
            <form class="ajax-form" th:action="@{/guest/cart/remove}" method="post">
                <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                <input type="hidden" name="tableId" th:value="${tableId}"/>
                <input type="hidden" name="productId" th:value="${item.productId}"/>
                <input type="hidden" name="productSizeId" th:value="${item.productSize.id}"/>
                <button class="remove-btn" type="submit">‚úï</button>
            </form>
        </div>
    </div>
    <div class="summary">
        <th:block th:with="cartTotalSum=${#aggregates.sum(cartItems.![totalPrice])}">
            <div class="row" th:if="${!#lists.isEmpty(cartItems)}">
                <span>Total</span>
                <span class="total" id="cartTotal" th:text="${#numbers.formatCurrency(cartTotalSum)}">0‚Ç´</span>
            </div>
        </th:block>
    </div>
    <form class="ajax-form" th:action="@{/guest/order/place}" method="post">
        <input type="hidden" name="sessionId" th:value="${sessionId}"/>
        <input type="hidden" name="tableId" th:value="${tableId}"/>
        <button class="btn btn-primary" type="submit" th:disabled="${#lists.isEmpty(cartItems)}">
            Place my Order üßæ
        </button>
    </form>
</div>

</body>
</html>