<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<!-- =============================================================== -->
<!-- FRAGMENT CHO DANH SÃCH ÄÃƒ Äáº¶T (ORDER)                            -->
<!-- =============================================================== -->
<div th:fragment="order-view" class="order-section">
    <h2>My Order ğŸ—’ï¸</h2>
    <div class="items-list" id="orderedItemsList">
        <th:block th:if="${#lists.isEmpty(orderedItems)}">
            <p class="empty-message">You haven't ordered anything yet.</p>
        </th:block>

        <div class="order-item" th:each="item : ${orderedItems}">
            <div class="item-details">
                <div class="name" th:text="${item.productName} + ' x' + ${item.quantity}"></div>
                <div class="size" th:text="${item.productSize.size.sizeName}">Default</div>
                <div class="price" th:text="${#numbers.formatCurrency(item.totalPrice)}">0Ä‘</div>
                <div class="note" th:text="${item.note}"></div>
            </div>

            <span class="status" th:text="${item.status}"></span>
            <!-- Chá»‰ hiá»ƒn thá»‹ nÃºt Cancel khi tráº¡ng thÃ¡i lÃ  PENDING -->
            <form class="ajax-form"
                  th:if="${#strings.equalsIgnoreCase(item.status?.toString(), 'PENDING')}"
                  th:action="@{/guest/order/cancel}" method="post"
                  style="display:inline-block; margin-left:10px;">
                <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                <input type="hidden" name="orderItemId" th:value="${item.id}"/>
                <input type="hidden" name="tableId" th:value="${tableId}"/>
                <button type="submit" class="btn btn-danger" style="padding:4px 8px;">
                    Cancel âŒ
                </button>
            </form>
        </div>
    </div>

    <div class="summary">
        <th:block th:with="orderTotalSum=${#aggregates.sum(orderedItems.![totalPrice])}">
            <div class="row" th:if="${!#lists.isEmpty(orderedItems)}">
                <span>Order Total</span>
                <span class="total" id="orderTotal"
                      th:text="${#numbers.formatCurrency(orderTotalSum)}">0â‚«</span>
            </div>
        </th:block>
    </div>

    <button class="btn btn-primary"
            th:onclick="|window.location.href='/pizzario/guest/payment/session/' + ${sessionId}|"
            th:disabled="${#lists.isEmpty(orderedItems)}">
        <i class="fas fa-credit-card"></i> Request Payment
    </button>
</div>

</body>
</html>
