<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<!-- =============================================================== -->
<!-- FRAGMENT CHO DANH S√ÅCH ƒê√É ƒê·∫∂T (ORDER)                            -->
<!-- =============================================================== -->
<div th:fragment="order-view" id="order-view" class="order-section">
    <h2>M√≥n ƒë√£ g·ªçi üóíÔ∏è</h2>
    <div class="items-list" id="orderedItemsList">
        <th:block th:if="${#lists.isEmpty(orderedItems)}">
            <p class="empty-message">B·∫°n ch∆∞a g·ªçi m√≥n n√†o.</p>
        </th:block>

        <div class="order-item"
             th:each="item : ${orderedItems}"
             th:attr="data-order-item-id=${item.id}"
             th:classappend="${
               #strings.equalsIgnoreCase(item.status, 'PENDING') ? ' order-status-pending' : (
               #strings.equalsIgnoreCase(item.status, 'PREPARING') ? ' order-status-preparing' : (
               #strings.equalsIgnoreCase(item.status, 'READY') ? ' order-status-ready' : (
               #strings.equalsIgnoreCase(item.status, 'SERVED') ? ' order-status-served' : (
               #strings.equalsIgnoreCase(item.status, 'CANCELLED') ? ' order-status-cancelled' : ' order-status-unknown'
             )))) }">
            <div class="item-details">
                <div class="name" th:text="${item.productName} + ' x' + ${item.quantity}"></div>
                <div class="size" th:text="${item.productSize.size.sizeName}">Default</div>
                <div class="price" th:text="${#numbers.formatCurrency(item.totalPrice)}">0ƒë</div>
                <div class="note" th:text="${item.note}"></div>
            </div>

            <span class="status"
                  th:classappend="${
                    #strings.equalsIgnoreCase(item.status, 'PENDING') ? ' status-pending' : (
                    #strings.equalsIgnoreCase(item.status, 'PREPARING') ? ' status-preparing' : (
                    #strings.equalsIgnoreCase(item.status, 'READY') ? ' status-ready' : (
                    #strings.equalsIgnoreCase(item.status, 'SERVED') ? ' status-served' : (
                    #strings.equalsIgnoreCase(item.status, 'CANCELLED') ? ' status-cancelled' : ''
                  )))) }"
                  th:text="${
                    #strings.equalsIgnoreCase(item.status, 'PENDING') ? 'ƒêang ch·ªù' : (
                    #strings.equalsIgnoreCase(item.status, 'PREPARING') ? 'ƒêang chu·∫©n b·ªã' : (
                    #strings.equalsIgnoreCase(item.status, 'READY') ? 'S·∫µn s√†ng' : (
                    #strings.equalsIgnoreCase(item.status, 'SERVED') ? 'ƒê√£ ph·ª•c v·ª•' : (
                    #strings.equalsIgnoreCase(item.status, 'CANCELLED') ? 'ƒê√£ h·ªßy' : item.status
                  )))) }"></span>
            <!-- N√∫t Cancel ch·ªâ hi·ªÉn th·ªã khi tr·∫°ng th√°i l√† PENDING -->
            <form class="ajax-form"
                  th:action="@{/guest/order/cancel}" method="post"
                  th:style="${#strings.equalsIgnoreCase(item.status, 'PENDING')} ? 'display:inline-block; margin-left:10px;' : 'display:none; margin-left:10px;'">
                <input type="hidden" name="sessionId" th:value="${sessionId}"/>
                <input type="hidden" name="orderItemId" th:value="${item.id}"/>
                <input type="hidden" name="tableId" th:value="${tableId}"/>
                <button type="submit" class="btn btn-danger" style="padding:4px 8px;">
                    H·ªßy ‚ùå
                </button>
            </form>
        </div>
    </div>

    <div class="summary">
        <th:block th:with="orderTotalSum=${#aggregates.sum(orderedItems.![totalPrice])}">
            <div class="row" th:if="${!#lists.isEmpty(orderedItems)}">
                <span>T·ªïng ƒë∆°n</span>
                <span class="total" id="orderTotal"
                      th:text="${#numbers.formatCurrency(orderTotalSum)}">0‚Ç´</span>
            </div>
        </th:block>
    </div>

    <button class="btn btn-primary"
            th:onclick="|window.location.href='/pizzario/guest/payment/session/' + ${sessionId}|"
            th:disabled="${#lists.isEmpty(orderedItems)}">
        <i class="fas fa-credit-card"></i> Y√™u c·∫ßu thanh to√°n
    </button>
</div>

</body>
</html>
