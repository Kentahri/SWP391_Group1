<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - PizzarIO</title>
    <link rel="stylesheet" th:href="@{/css/kitchen.css}" />
    <link rel="stylesheet" th:href="@{/css/kitchen-dashboard.css}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- WebSocket Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script th:src="@{/js/kitchen/websocket.js}"></script>
</head>
<body>
    <!-- Top bar -->
    <header class="topbar">
        <div class="brand">üçï PizzarIO</div>
        <div class="staff-info">
            <span>T√™n: <strong th:text="${staff.name}">Kitchen Staff</strong></span>
        </div>
        <div class="datetime-info">
            <div id="clock" class="clock">--:--:--</div>
            <div id="date" class="date">--/--/----</div>
        </div>
        <div class="actions">
            <a th:href="@{/kitchen/dashboard}" class="btn btn-secondary" style="text-decoration: none; display: inline-block">
                üìä Dashboard
            </a>
            <a th:href="@{/kitchen/order-list}" class="btn btn-primary" style="text-decoration: none; display: inline-block">
                üìã Danh s√°ch ƒë∆°n h√†ng
            </a>
            <a th:href="@{/kitchen/outstock}" class="btn btn-secondary" style="text-decoration: none; display: inline-block">
                üçΩÔ∏è Qu·∫£n l√Ω Menu
            </a>
            <form th:action="@{/logout}" method="post" style="display: inline;">
                <input
                    type="hidden"
                    th:if="${_csrf != null}"
                    th:name="${_csrf.parameterName}"
                    th:value="${_csrf.token}"
                />
                <button
                    type="submit"
                    class="btn-logout"
                    onclick="return confirm('B·∫°n c√≥ mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?')"
                >
                    üö™ ƒêƒÉng xu·∫•t
                </button>
            </form>
        </div>
    </header>

    <!-- Main Content -->
    <main class="kitchen-main">
        <!-- Page Title -->
        <div class="dashboard-title">
            <div class="title-left">
                <h1><i class="fas fa-list"></i> Qu·∫£n l√Ω Orders</h1>
                <p>Xem v√† qu·∫£n l√Ω c√°c ƒë∆°n h√†ng ƒëang x·ª≠ l√Ω</p>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="om-filter-bar">
            <a
                th:href="@{/kitchen/order-list}"
                class="om-tab"
                th:classappend="${status == null and type == null} ? 'active' : ''"
            >
                <span class="om-icon">&#9679;</span> 
                ƒêang x·ª≠ l√Ω (<span th:text="${processingCount}">0</span>)
            </a>
            <a
                th:href="@{/kitchen/order-list(type='DINE_IN')}"
                class="om-tab"
                th:classappend="${type == 'DINE_IN'} ? 'active' : ''"
            >
                <span class="om-icon">&#x1F374;</span> 
                T·∫°i b√†n (<span th:text="${dineInCount}">0</span>)
            </a>
            <a
                th:href="@{/kitchen/order-list(type='TAKE_AWAY')}"
                class="om-tab"
                th:classappend="${type == 'TAKE_AWAY'} ? 'active' : ''"
            >
                <span class="om-icon">&#x1F3EA;</span> 
                Take away (<span th:text="${takeAwayCount}">0</span>)
            </a>
            <a
                th:href="@{/kitchen/order-list(status='COMPLETED')}"
                class="om-tab"
                th:classappend="${status == 'COMPLETED'} ? 'active' : ''"
            >
                <span class="om-icon">&#x2714;</span> 
                Ho√†n th√†nh (<span th:text="${completedCount}">0</span>)
            </a>
        </div>

        <!-- Order List -->
        <div class="order-list" id="order-list">
            <div
                class="order-card"
                th:each="order : ${orders}"
                th:attr="data-order-id=${order.id},data-status=${order.status},data-type=${order.type}"
            >
                <div class="order-header">
                    <span class="order-id" th:text="${order.code}">ORD-XXX</span>
                    <span class="badge yellow" th:if="${order.status eq 'PREPARING'}"
                        >ƒêang chu·∫©n b·ªã</span
                    >
                    <span class="badge gray" th:if="${order.status eq 'COMPLETED'}"
                        >Ho√†n th√†nh</span
                    >
                    <span class="badge red" th:if="${order.status eq 'CANCELLED'}"
                        >ƒê√£ h·ªßy</span
                    >
                </div>
                <div class="order-meta">
                    <span class="order-table">
                        <i class="fa fa-map-marker-alt"></i>
                        <span
                            th:text="${order.tableName != null ? order.tableName : order.type}"
                            >B√†n/Take away</span
                        >
                    </span>
                    <span class="order-time">
                        <i class="fa fa-clock"></i>
                        <span th:text="${order.timeAgo}">5 ph√∫t tr∆∞·ªõc</span>
                    </span>
                </div>
                <div class="order-total">
                    <span class="total-price">
                        T·ªïng:
                        <span
                            th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' VNƒê'"
                            >0 VNƒê</span
                        >
                    </span>
                </div>
                <a
                    th:href="@{|/kitchen/order/${order.id}|}"
                    class="order-detail-btn"
                    >Xem chi ti·∫øt</a
                >
            </div>
            <div th:if="${#lists.isEmpty(orders)}" class="no-orders">
                Kh√¥ng c√≥ ƒë∆°n n√†o.
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script>
        // Clock and Date Display
        const $clock = document.getElementById("clock");
        const $date = document.getElementById("date");

        function renderDateTime() {
            const now = new Date();
            if ($clock) {
                $clock.textContent = now.toLocaleTimeString("vi-VN", { hour12: false });
            }
            if ($date) {
                $date.textContent = now.toLocaleDateString("vi-VN", {
                    weekday: "long",
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                });
            }
        }

        renderDateTime();
        setInterval(renderDateTime, 1000);
    </script>
</body>
</html>