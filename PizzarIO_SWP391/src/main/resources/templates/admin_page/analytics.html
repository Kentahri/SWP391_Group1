<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Analytics ‚Ä¢ Admin Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/admin_page/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/admin_page/analytics.css}" />
  </head>
  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="brand">
          <div class="logo">üçï</div>
          <div class="brand-text">
            <strong>Admin</strong><span>Qu·∫£n l√Ω nh√† h√†ng</span>
          </div>
        </div>
        <nav class="nav">
          <a class="nav-link active" th:href="@{/manager/analytics}"
            >S·ªë li·ªáu ph√¢n t√≠ch</a
          >
          <a class="nav-link" th:href="@{/manager/products}">S·∫£n ph·∫©m</a>
          <a class="nav-link" th:href="@{/manager/categories}"> Danh m·ª•c</a>
          <a class="nav-link" th:href="@{/manager/vouchers}">Voucher</a>
          <a class="nav-link" th:href="@{/manager/staff}">Nh√¢n vi√™n</a>
          <a class="nav-link" th:href="@{/manager/shifts}">Ca l√†m vi·ªác</a>
          <a class="nav-link" th:href="@{/manager/complaints}"> Khi·∫øu n·∫°i</a>
          <a class="nav-link" th:href="@{/manager/inventory}"> Kho h√†ng</a>
          <a class="nav-link" th:href="@{/manager/settings}">C√†i ƒë·∫∑t</a>
        </nav>

        <form th:action="@{/logout}" method="post">
          <input
            type="hidden"
            th:if="${_csrf != null}"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <button type="submit">Logout</button>
        </form>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <header class="page-header">
          <div>
            <h1>Admin Dashboard</h1>
            <p class="muted">Qu·∫£n l√Ω nh√† h√†ng</p>
          </div>
          <div class="userbox">
            <div class="avatar">M</div>
            <div class="who">
              <!-- TODO bind: t√™n ng∆∞·ªùi ƒëƒÉng nh·∫≠p -->
              <strong id="currentUser">‚Äî</strong>
              <!-- TODO bind: vai tr√≤ -->
              <span id="currentRole" class="muted">‚Äî</span>
            </div>
          </div>
        </header>

        <section>
          <div class="analytics-header">
            <div>
              <h2>S·ªë li·ªáu ph√¢n t√≠ch v·ªÅ k√™nh</h2>
              <p class="muted">
                Ch·ªâ s·ªë th·ªùi gian ‚Ä¢
                <span
                  id="rangeLabel"
                  th:text="${dateRangeLabel} ?: '28 ng√†y qua'"
                  >28 ng√†y qua</span
                >
              </p>
            </div>

            <!-- Dropdown ch·ªçn kho·∫£ng th·ªùi gian -->
            <div class="time-range-wrapper">
              <select id="timeRangeSelect">
                <option
                  value="7"
                  th:selected="${selectedDays != null && selectedDays == 7}"
                >
                  7 ng√†y qua
                </option>
                <option
                  value="28"
                  th:selected="${selectedDays == null || selectedDays == 28}"
                >
                  28 ng√†y qua
                </option>
                <option value="custom" th:selected="${isCustomRange}">
                  T√πy ch·ªânh
                </option>
              </select>

              <!-- Date pickers cho t√πy ch·ªânh -->
              <div id="customDateRange">
                <div class="date-field">
                  <label>T·ª´ ng√†y:</label>
                  <input type="date" id="startDate" />
                </div>
                <div class="date-field">
                  <label>ƒê·∫øn ng√†y:</label>
                  <input type="date" id="endDate" />
                </div>
                <button id="applyCustomDate">√Åp d·ª•ng</button>
              </div>
            </div>
          </div>

          <!-- KPI (4 th·∫ª) -->
          <div class="grid four">
            <article class="card">
              <div class="card-title">Doanh thu</div>
              <p
                class="kpi-value"
                th:text="${#numbers.formatDecimal(analytics.totalRevenue, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"
              >
                0 ƒë
              </p>
              <p
                class="kpi-delta"
                th:classappend="${analytics.revenueDelta >= 0 ? 'positive' : 'negative'}"
              >
                <span
                  th:text="${analytics.revenueDelta >= 0 ? '‚Üë' : '‚Üì'}"
                ></span>
                <span
                  th:text="${#numbers.formatDecimal(analytics.revenueDelta, 1, 2)}"
                  >0</span
                >%
                <span
                  class="comparison-text"
                  th:text="${selectedDays != null ? 'so v·ªõi ' + selectedDays + ' ng√†y tr∆∞·ªõc' : 'so v·ªõi 28 ng√†y tr∆∞·ªõc'}"
                >
                  so v·ªõi 28 ng√†y tr∆∞·ªõc
                </span>
              </p>
            </article>

            <article class="card">
              <div class="card-title">ƒê∆°n h√†ng</div>
              <p class="kpi-value" th:text="${analytics.totalOrders()}">0ƒë</p>
              <p
                class="kpi-delta"
                th:classappend="${analytics.totalOrders() >= 0 ? 'positive' : 'negative'}"
              >
                <span
                  th:text="${analytics.ordersDelta() >= 0 ? '‚Üë' : '‚Üì'}"
                ></span>
                <span
                  th:text="${#numbers.formatDecimal(analytics.ordersDelta(), 1, 2)}"
                  >0</span
                >%
                <span
                  class="comparison-text"
                  th:text="${selectedDays != null ? 'so v·ªõi ' + selectedDays + ' ng√†y tr∆∞·ªõc' : 'so v·ªõi 28 ng√†y tr∆∞·ªõc'}"
                >
                  so v·ªõi 28 ng√†y tr∆∞·ªõc
                </span>
              </p>
            </article>

            <article class="card">
              <div class="card-title">Kh√°ch m·ªõi</div>
              <p class="kpi-value" th:text="${analytics.newCustomers()}">0ƒë</p>
              <p
                class="kpi-delta"
                th:classappend="${analytics.newCustomersDelta() >= 0 ? 'positive' : 'negative'}"
              >
                <span
                  th:text="${analytics.newCustomersDelta >= 0 ? '‚Üë' : '‚Üì'}"
                ></span>
                <span
                  th:text="${#numbers.formatDecimal(analytics.newCustomersDelta, 1, 2)}"
                  >0</span
                >%
                <span
                  class="comparison-text"
                  th:text="${selectedDays != null ? 'so v·ªõi ' + selectedDays + ' ng√†y tr∆∞·ªõc' : 'so v·ªõi 28 ng√†y tr∆∞·ªõc'}"
                >
                  so v·ªõi 28 ng√†y tr∆∞·ªõc
                </span>
              </p>
            </article>

            <article class="card">
              <div class="card-title">Gi√° tr·ªã TB</div>
              <p
                class="kpi-value"
                th:text="${#numbers.formatDecimal(analytics.aov(), 0, 'COMMA', 0, 'POINT')} + ' ƒë'"
              >
                0 ƒë
              </p>
              <p
                class="kpi-delta"
                th:classappend="${analytics.aovDelta() >= 0 ? 'positive' : 'negative'}"
              >
                <span th:text="${analytics.aovDelta >= 0 ? '‚Üë' : '‚Üì'}"></span>
                <span
                  th:text="${#numbers.formatDecimal(analytics.aovDelta, 1, 2)}"
                  >0</span
                >%
                <span
                  class="comparison-text"
                  th:text="${selectedDays != null ? 'so v·ªõi ' + selectedDays + ' ng√†y tr∆∞·ªõc' : 'so v·ªõi 28 ng√†y tr∆∞·ªõc'}"
                >
                  so v·ªõi 28 ng√†y tr∆∞·ªõc
                </span>
              </p>
            </article>
          </div>

          <div class="main-analytics">
            <!-- Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng -->
            <article class="card">
              <div class="card-title">Doanh thu theo th·ªùi gian</div>
              <div class="chartCard">
                <div class="chartBox">
                  <canvas id="myChartLine"></canvas>
                </div>
              </div>
            </article>

            <!-- C·ªôt ph·∫£i -->
            <aside class="analytics-sidebar">
              <article class="card">
                <div class="card-title">Th·ªùi gian th·ª±c</div>
                <div class="list">
                  <!-- TODO bind: ƒë∆°n h√¥m nay -->
                  <div class="row">
                    <span class="muted">ƒê∆°n h√†ng h√¥m nay</span
                    ><strong class="big" id="todayOrders">‚Äî</strong>
                  </div>
                  <!-- TODO bind: doanh thu h√¥m nay -->
                  <div class="row">
                    <span class="muted">Doanh thu h√¥m nay</span
                    ><strong class="big green revenue-amount" id="todayRevenue"
                      >‚Äî</strong
                    >
                  </div>
                </div>
              </article>

              <article class="card">
                <div class="card-title">Xem chi ti·∫øt kh√°ch h√†ng</div>
                <div class="list">
                  <!-- TODO bind: KH m·ªõi h√¥m nay -->
                  <div class="row">
                    <span class="muted">Kh√°ch h√†ng m·ªõi</span
                    ><strong
                      id="todayNewCustomers"
                      th:text="${analytics.newCustomers()}"
                      >‚Äî</strong
                    >
                  </div>
                  <!-- TODO bind: KH quay l·∫°i -->
                  <div class="row">
                    <span class="muted">Kh√°ch h√†ng quay l·∫°i</span
                    ><strong
                      id="todayReturning"
                      th:text="${analytics.oldCustomers()}"
                      >‚Äî</strong
                    >
                  </div>
                  <!-- TODO bind: t·ª∑ l·ªá gi·ªØ ch√¢n -->
                  <div class="row">
                    <span class="muted">T·ª∑ l·ªá gi·ªØ ch√¢n</span
                    ><strong
                      id="retentionRate"
                      th:text="${analytics.retentionRate()}"
                      >‚Äî</strong
                    >
                  </div>
                </div>
              </article>
            </aside>
          </div>

          <!-- V√πng d∆∞·ªõi: 2 cards -->
          <div class="grid two bottom-grid">
            <article class="card">
              <div class="card-title">Top s·∫£n ph·∫©m b√°n ch·∫°y</div>
              <table class="table" id="tableTopProducts">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>S·∫£n ph·∫©m</th>
                    <th>ƒê∆°n</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th>Doanh thu</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:if="${topProducts == null || topProducts.isEmpty()}">
                    <td colspan="5" style="text-align: center">
                      Ch∆∞a c√≥ d·ªØ li·ªáu
                    </td>
                  </tr>
                  <tr th:each="product : ${topProducts}">
                    <td th:text="${product.topId}">1</td>
                    <td class="product-name" th:text="${product.productName}">
                      Pizza Margherita
                    </td>
                    <td class="text-center" th:text="${product.orderCount}">
                      0
                    </td>
                    <td class="text-center" th:text="${product.quantitySold}">
                      0
                    </td>
                    <td
                      class="revenue-cell"
                      th:text="${#numbers.formatDecimal(product.totalRevenue, 0, 'COMMA', 0, 'POINT')} + ' ƒë'"
                    >
                      0 ƒë
                    </td>
                  </tr>
                </tbody>
              </table>
            </article>

            <article class="card">
              <div class="card-title">Doanh thu 7 ng√†y g·∫ßn nh·∫•t</div>
              <!-- TODO bind: data-series(JSON) ƒë·ªÉ v·∫Ω chart c·ªôt -->
              <div class="chartCard">
                <div class="chartBox">
                  <canvas id="myChartBar"></canvas>
                </div>
              </div>
            </article>
          </div>
        </section>
      </main>
    </div>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"
    ></script>

    <script th:inline="javascript">
      /*<![CDATA[*/
      window.CHART_DATA = {
        // Bar Chart Data
        labels_bar: /*[[${labels_bar}]]*/ [],
        data_bar: /*[[${data_bar}]]*/ [],

        // Line Chart Data
        labels_Line: /*[[${labels_Line}]]*/ [],
        data_Line: /*[[${data_Line}]]*/ [],
      };
      /*]]>*/
    </script>

    <script th:src="@{/js/date-range-filter.js}"></script>
    <script th:src="@{/js/chart-data.js}" defer></script>
  </body>
</html>
