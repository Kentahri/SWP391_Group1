<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω B√†n ƒÉn ‚Ä¢ Admin Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/admin_page/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/admin_page/table-management.css}" />
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}" />
    <meta
      name="_csrf_parameter"
      th:if="${_csrf != null}"
      th:content="${_csrf.parameterName}"
    />
  </head>

  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <div th:insert="~{fragments/sidebar :: sidebar('tables')}"></div>

      <!-- MAIN -->
      <div class="main-content">
        <header class="page-header">
          <div>
            <h1>Qu·∫£n l√Ω B√†n ƒÉn</h1>
            <p class="muted">Qu·∫£n l√Ω v√† theo d√µi tr·∫°ng th√°i b√†n ƒÉn</p>
          </div>
          <div class="userbox">
            <div class="avatar">M</div>
            <div class="who">
              <strong>Manager</strong>
              <span class="muted">Qu·∫£n l√Ω</span>
            </div>
          </div>
        </header>

        <!-- Section Header -->
        <div class="section-header">
          <div>
            <h2>S∆° ƒë·ªì b√†n ƒÉn</h2>
            <p class="muted">Click v√†o b√†n ƒë·ªÉ xem chi ti·∫øt</p>
          </div>
          <button id="openAddTable" class="primary-btn" type="button">
            ‚ûï Th√™m b√†n m·ªõi
          </button>
        </div>

        <!-- Grid Layout: S∆° ƒë·ªì b√†n + Chi ti·∫øt b√†n -->
        <div class="grid">
          <!-- Left: S∆° ƒë·ªì b√†n -->
          <div class="card">
            <div class="card-title">ü™ë S∆° ƒë·ªì b√†n</div>
            <div class="map-grid">
              <div
                th:each="table: ${tables}"
                class="tile"
                th:attr="
                  data-id=${table.id},
                  data-status=${table.tableStatus != null ? table.tableStatus.name() : 'AVAILABLE'},
                  data-capacity=${table.capacity},
                  data-created-at=${#temporals.format(table.createdAt,'yyyy-MM-dd HH:mm')},
                  data-updated-at=${#temporals.format(table.updatedAt,'yyyy-MM-dd HH:mm')},
                  data-condition=${table.tableCondition != null ? table.tableCondition.name() : 'UNKNOWN'},
                  data-update-url=@{'/manager/tables/update/' + ${table.id}}"
              >
                <span class="status-dot"></span>
                <h4>B√†n <span th:text="${table.id}"></span></h4>
                <small>(<span th:text="${table.capacity}"></span> ch·ªó)</small>
              </div>
            </div>
          </div>

          <!-- Right: Chi ti·∫øt b√†n -->
          <div class="card">
            <div class="card-title">üìã Chi ti·∫øt b√†n</div>
            <div>
              <div class="detail-row">
                <strong id="tableName">Ch·ªçn m·ªôt b√†n</strong>
              </div>
              <div class="detail-row">
                <span class="muted">Tr·∫°ng th√°i:</span>
                <span id="detailStatus" class="status-badge">‚Äî</span>
              </div>
              <div class="detail-row">
                <span class="muted">S·ª©c ch·ª©a:</span>
                <span><span id="detailCapacity">‚Äî</span> ng∆∞·ªùi</span>
              </div>
              <div class="detail-row">
                <span class="muted">T√¨nh tr·∫°ng:</span>
                <span id="detailCondition">‚Äî</span>
              </div>
              <div class="detail-row">
                <span class="muted">T·∫°o l√∫c:</span>
                <span id="detailCreatedAt">‚Äî</span>
              </div>
              <div class="detail-row">
                <span class="muted">C·∫≠p nh·∫≠t:</span>
                <span id="detailUpdatedAt">‚Äî</span>
              </div>

              <!-- Status Legend -->
              <div class="status-legend">
                <div class="legend-title">üìä Ch√∫ gi·∫£i tr·∫°ng th√°i</div>
                <div class="legend-items">
                  <div class="legend-item">
                    <span class="legend-dot available"></span>
                    <span class="legend-text">AVAILABLE - C√≥ s·∫µn</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-dot occupied"></span>
                    <span class="legend-text">OCCUPIED - ƒêang d√πng</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-dot paying"></span>
                    <span class="legend-text">PAYING - Thanh to√°n</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-dot reserved"></span>
                    <span class="legend-text">RESERVED - ƒê√£ ƒë·∫∑t</span>
                  </div>
                </div>
                <div class="legend-note">
                  <small
                    >‚ÑπÔ∏è Tr·∫°ng th√°i b√†n do Cashier qu·∫£n l√Ω, Manager ch·ªâ
                    xem</small
                  >
                </div>
              </div>

              <div id="tableActions" th:if="${!tables.isEmpty()}">
                <button id="updateTableBtn" class="primary-btn">
                  ‚úèÔ∏è C·∫≠p nh·∫≠t b√†n
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal: Add Table -->
        <div id="addTableModal" class="modal-overlay" aria-hidden="true">
          <div class="modal" role="dialog" aria-modal="true">
            <header>Th√™m b√†n m·ªõi</header>
            <div class="content">
              <form
                id="addTableForm"
                th:action="@{/manager/tables/add}"
                method="post"
                th:object="${tableCreateDTO}"
              >
                <input
                  type="hidden"
                  th:if="${_csrf != null}"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
                />
                <div class="form-row">
                  <label>S·ª©c ch·ª©a (s·ªë ng∆∞·ªùi)</label>
                  <label>
                    <input
                      type="number"
                      id="newCapacity"
                      name="capacity"
                      th:field="*{capacity}"
                      min="1"
                      max="20"
                      required
                      placeholder="Nh·∫≠p s·ªë ch·ªó ng·ªìi"
                    />
                  </label>
                </div>
                <div class="info-box">
                  <p>‚ÑπÔ∏è B√†n m·ªõi s·∫Ω t·ª± ƒë·ªông c√≥:</p>
                  <ul>
                    <li>Tr·∫°ng th√°i: AVAILABLE</li>
                    <li>T√¨nh tr·∫°ng: NEW</li>
                  </ul>
                </div>
                <div class="actions">
                  <button
                    type="button"
                    class="btn-secondary"
                    id="cancelAddTable"
                  >
                    H·ªßy
                  </button>
                  <button type="submit" class="primary-btn">Th√™m</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Modal: Update Table -->
        <div id="updateTableModal" class="modal-overlay" aria-hidden="true">
          <div class="modal" role="dialog" aria-modal="true">
            <header>C·∫≠p nh·∫≠t b√†n</header>
            <div class="content">
              <form id="updateTableForm" method="post">
                <input
                  type="hidden"
                  th:if="${_csrf != null}"
                  th:name="${_csrf.parameterName}"
                  th:value="${_csrf.token}"
                />
                <div class="form-row">
                  <label>S·ª©c ch·ª©a (s·ªë ng∆∞·ªùi)</label>
                  <label>
                    <input
                      type="number"
                      id="updateCapacity"
                      name="capacity"
                      min="1"
                      max="20"
                      required
                      placeholder="Nh·∫≠p s·ªë ch·ªó ng·ªìi"
                    />
                  </label>
                </div>
                <div class="form-row">
                  <label>T√¨nh tr·∫°ng b√†n</label>
                  <label>
                    <select
                      id="updateTableCondition"
                      name="tableCondition"
                      required
                    >
                      <option
                        th:each="condition : ${tableConditions}"
                        th:value="${condition}"
                        th:text="${condition}"
                      ></option>
                    </select>
                  </label>
                </div>
                <div class="info-box">
                  <p>
                    ‚ÑπÔ∏è L∆∞u √Ω: Tr·∫°ng th√°i b√†n (AVAILABLE/OCCUPIED...) do Cashier
                    qu·∫£n l√Ω
                  </p>
                </div>
                <div class="actions">
                  <button
                    type="button"
                    class="btn-secondary"
                    id="cancelUpdateTable"
                  >
                    H·ªßy
                  </button>
                  <button type="submit" class="primary-btn">C·∫≠p nh·∫≠t</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script th:src="@{/js/admin/table-management.js}"></script>
  </body>
</html>
