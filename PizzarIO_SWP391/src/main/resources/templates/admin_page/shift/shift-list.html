<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Qu·∫£n l√Ω ca l√†m vi·ªác ‚Ä¢ Admin Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/admin_page/styles.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin_page/shift-list.css}"/>
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}"/>
    <meta
            name="_csrf_parameter"
            th:if="${_csrf != null}"
            th:content="${_csrf.parameterName}"
    />
</head>
<body>
<div class="app">
    <div th:insert="~{fragments/sidebar :: sidebar('shifts')}"></div>

    <div class="main-content">
        <div class="page-header">
            <div class="header-content">
                <h1>Qu·∫£n l√Ω ca l√†m vi·ªác</h1>
                <div
                        th:if="${message != null}"
                        class="alert alert-success"
                        th:text="${message}"
                ></div>
                <div
                        th:if="${error != null}"
                        class="alert alert-danger"
                        th:text="${error}"
                ></div>
                <p class="subtitle">Th√™m, s·ª≠a, x√≥a c√°c ca l√†m vi·ªác</p>
            </div>

            <button class="btn-add-shift" onclick="openShiftModal()">
                <span>+</span> Th√™m ca l√†m vi·ªác
            </button>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-nav" style="margin-bottom: 20px">
            <a th:href="@{/manager/staff_shifts}" class="tab-btn">
                üìÖ L·ªãch ph√¢n c√¥ng ca
            </a>
            <a th:href="@{/manager/shifts}" class="tab-btn active">
                ‚öôÔ∏è Qu·∫£n l√Ω lo·∫°i ca
            </a>
        </div>

        <div class="shift-table-container">
            <!-- Modal -->
            <div id="shiftModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modalTitle">Th√™m ca l√†m vi·ªác m·ªõi</h2>
                        <span class="close" onclick="closeShiftModal()">&times;</span>
                    </div>

                    <form
                            id="shiftForm"
                            method="post"
                            th:object="${shiftForm}"
                            th:action="@{/manager/shift/save}"
                    >
                        <input type="hidden" th:field="*{id}"/>
                        <input
                                type="hidden"
                                th:if="${_csrf != null}"
                                th:name="${_csrf.parameterName}"
                                th:value="${_csrf.token}"
                        />

                        <div class="mb-3">
                            <label for="shiftType">Lo·∫°i ca l√†m vi·ªác</label>
                            <select id="shiftType" th:field="*{shiftName}">
                                <option value="" disabled>-- Ch·ªçn lo·∫°i ca --</option>
                                <option value="SANG">S√°ng</option>
                                <option value="CHIEU">Chi·ªÅu</option>
                                <option value="TOI">T·ªëi</option>
                            </select>
                            <span
                                    class="error-message"
                                    th:if="${#fields.hasErrors('shiftName')}"
                                    th:errors="*{shiftName}"
                            ></span>
                        </div>

                        <div class="mb-3">
                            <label for="startTimeOnly">Gi·ªù b·∫Øt ƒë·∫ßu</label>
                            <input
                                    type="time"
                                    id="startTimeOnly"
                                    name="startTimeOnly"
                                    th:class="${#fields.hasErrors('startTime')} ? 'error-field' : ''"
                                    th:value="${shiftForm.startTime != null ? #temporals.format(shiftForm.startTime, 'HH:mm:ss') : ''}"
                                    step="1"
                            />
                            <span
                                    class="error-message"
                                    th:if="${#fields.hasErrors('startTime')}"
                                    th:errors="*{startTime}"
                            ></span>
                        </div>

                        <div class="mb-3">
                            <label for="endTimeOnly">Gi·ªù k·∫øt th√∫c</label>
                            <input
                                    type="time"
                                    id="endTimeOnly"
                                    name="endTimeOnly"
                                    th:class="${#fields.hasErrors('endTime')} ? 'error-field' : ''"
                                    th:value="${shiftForm.endTime != null ? #temporals.format(shiftForm.endTime, 'HH:mm:ss') : ''}"
                                    step="1"
                            />
                            <span
                                    class="error-message"
                                    th:if="${#fields.hasErrors('endTime')}"
                                    th:errors="*{endTime}"
                            ></span>
                        </div>

                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">L∆∞u</button>
                            <button
                                    type="button"
                                    class="btn btn-secondary"
                                    onclick="closeShiftModal()"
                            >
                                H·ªßy
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Table -->
            <table class="table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>T√™n ca l√†m vi·ªác</th>
                    <th>Gi·ªù b·∫Øt ƒë·∫ßu</th>
                    <th>Gi·ªù k·∫øt th√∫c</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="shift : ${shifts}">
                    <td th:text="${shift.id}">1</td>
                    <td th:text="${shift.shiftName == 'SANG' ? 'S√°ng' : (shift.shiftName == 'CHIEU' ? 'Chi·ªÅu' : (shift.shiftName == 'TOI' ? 'T·ªëi' : shift.shiftName))}">
                        Ca s√°ng
                    </td>
                    <td
                            th:text="${shift.startTime != null ? #temporals.format(shift.startTime, 'HH:mm') : '-'}"
                    >
                        08:00
                    </td>
                    <td
                            th:text="${shift.endTime != null ? #temporals.format(shift.endTime, 'HH:mm') : '-'}"
                    >
                        12:00
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button
                                    type="button"
                                    class="btn-icon btn-edit"
                                    title="S·ª≠a"
                                    th:onclick="|editShiftType(${shift.id})|"
                            >
                                S·ª≠a
                            </button>
                            <a
                                    th:href="@{'/manager/shift/delete/' + ${shift.id}}"
                                    th:class="${canDelete[shift.id]} ? 'btn-icon btn-delete' : 'btn-icon btn-delete disabled'"
                                    th:title="${canDelete[shift.id]} ? 'X√≥a' : 'Kh√¥ng th·ªÉ x√≥a v√¨ ƒë√£ c√≥ nh√¢n vi√™n ƒë∆∞·ª£c ph√¢n c√¥ng'"
                                    th:onclick="${canDelete[shift.id]} ? |return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ca #${shift.id}?');| : 'return false;'"
                                    th:style="${!canDelete[shift.id]} ? 'opacity: 0.5; cursor: not-allowed;' : ''"
                            >
                                X√≥a
                            </a>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script th:inline="javascript">
    window.openShiftModalFlag = /*[[${openShiftModal}]]*/ null;
    window.shiftTypes = /*[[${shiftTypes}]]*/ [];
</script>
<script th:src="@{/js/admin/shift-list.js}"></script>
<script th:src="@{/js/admin/product-dropdown.js}"></script>

</body>
</html>
