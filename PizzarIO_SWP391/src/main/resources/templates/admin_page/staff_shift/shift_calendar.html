<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω ca l√†m vi·ªác</title>
    <link rel="stylesheet" th:href="@{/css/admin_page/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/admin_page/shift-management.css}" />
  </head>
  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <div th:insert="~{fragments/sidebar :: sidebar('staff_shifts')}"></div>

      <!-- MAIN -->
      <main class="main">
        <header class="page-header">
          <div>
            <h1>Qu·∫£n l√Ω ca l√†m vi·ªác</h1>
            <p class="muted">Ph√¢n ca v√† theo d√µi th·ªùi gian l√†m vi·ªác</p>
          </div>
          <div class="userbox">
            <div class="avatar">M</div>
            <div class="who">
              <strong>Manager</strong>
              <span class="muted">Qu·∫£n l√Ω</span>
            </div>
          </div>
        </header>

         <div class="container">
           <!-- Tabs Navigation -->
           <div class="tabs-nav">
             <button class="tab-btn active" onclick="switchTab('calendar')">
               üìÖ L·ªãch ph√¢n c√¥ng ca
             </button>
             <button class="tab-btn" onclick="switchTab('shifts')">
               ‚öôÔ∏è Qu·∫£n l√Ω lo·∫°i ca
             </button>
           </div>

           <!-- Tab: Calendar View -->
           <div id="tab-calendar" class="tab-content active">
           <!-- Stats Cards -->
           <!--
        BACKEND TODO #1: T·∫°o controller method ƒë·ªÉ t√≠nh to√°n c√°c th·ªëng k√™:
        - totalShifts: T·ªïng s·ªë ca l√†m vi·ªác trong tu·∫ßn hi·ªán t·∫°i
        - totalHours: T·ªïng gi·ªù l√†m vi·ªác (sum c·ªßa t·∫•t c·∫£ ca)
        - totalWage: T·ªïng l∆∞∆°ng (sum c·ªßa hourlyWage * s·ªë gi·ªù l√†m)
        - completedShifts: S·ªë ca c√≥ status = "Ho√†n th√†nh"
        
        Model attributes c·∫ßn truy·ªÅn:
        @ModelAttribute("stats") ShiftStatisticsDTO stats
      -->
          <div class="stats-grid">
            <div class="stat-card blue">
              <div class="stat-content">
                <h3>T·ªïng ca l√†m vi·ªác</h3>
                <div class="stat-value" th:text="${stats != null ? stats.totalShifts : 0}">14</div>
              </div>
              <div class="stat-icon blue">üìÖ</div>
            </div>

            <div class="stat-card green">
              <div class="stat-content">
                <h3>T·ªïng gi·ªù l√†m</h3>
                <div class="stat-value" th:text="${stats != null ? stats.totalHours + 'h' : '0h'}">109h</div>
              </div>
              <div class="stat-icon green">üïê</div>
            </div>

            <div class="stat-card purple">
              <div class="stat-content">
                <h3>T·ªïng l∆∞∆°ng</h3>
                <div class="stat-value" th:text="${stats != null ? #numbers.formatDecimal(stats.totalWage, 0, 'POINT', 3, 'COMMA') + 'ƒë' : '0ƒë'}">4.180.000ƒë</div>
              </div>
              <div class="stat-icon purple">üë•</div>
            </div>

            <div class="stat-card orange">
              <div class="stat-content">
                <h3>Ca ho√†n th√†nh</h3>
                <div class="stat-value">
                  <span th:text="${stats != null ? stats.completedShifts : 0}">11</span>/<span th:text="${stats != null ? stats.totalShifts : 0}">14</span>
                </div>
              </div>
              <div class="stat-icon orange">‚ö†Ô∏è</div>
            </div>
          </div>

          <!-- Main Calendar Card -->
          <div class="main-card">
            <!-- Calendar Header with Filters -->
            <div class="calendar-header">
              <div class="calendar-title">
                <span>üìÖ</span>
                <span>L·ªãch ca l√†m vi·ªác</span>
              </div>

              <div class="calendar-controls">
                <!-- 
              BACKEND TODO #2: T·∫°o filter dropdown
              - L·∫•y danh s√°ch t·∫•t c·∫£ nh√¢n vi√™n t·ª´ database
              - Th√™m option "T·∫•t c·∫£ nh√¢n vi√™n"
              - Khi ch·ªçn, reload page v·ªõi query param: ?staffId=xxx
            -->
                <div class="filter-group">
                  <span class="filter-label">üîç</span>
                  <select class="filter-select" id="staffFilter" onchange="filterByStaff()">
                    <option value="">T·∫•t c·∫£ nh√¢n vi√™n</option>
                    <!-- BACKEND: Loop qua danh s√°ch staff - Model attribute: @ModelAttribute("allStaff") List<Staff> allStaff -->
                    <option th:each="staff : ${allStaff}" th:value="${staff.id}" th:text="${staff.name}" th:selected="${selectedStaffId != null && selectedStaffId == staff.id}"></option>
                  </select>
                </div>

                <div class="filter-group">
                  <select class="filter-select" id="shiftFilter" onchange="filterByShift()">
                    <option value="">T·∫•t c·∫£ ca</option>
                    <!-- BACKEND: Loop qua danh s√°ch shift types - Model attribute: @ModelAttribute("allShifts") List<Shift> allShifts -->
                    <option th:each="shift : ${allShifts}" th:value="${shift.id}" th:text="${shift.shiftName}" th:selected="${selectedShiftId != null && selectedShiftId == shift.id}"></option>
                  </select>
                </div>

                <button class="add-btn" onclick="window.location.href='/manager/staff_shifts/create'">+ Th√™m ca l√†m vi·ªác</button>
              </div>
            </div>

            <!-- Week Navigation -->
            <!-- 
          BACKEND TODO #3: X·ª≠ l√Ω tu·∫ßn hi·ªán t·∫°i
          - weekStartDate: Ng√†y b·∫Øt ƒë·∫ßu tu·∫ßn (LocalDate)
          - weekEndDate: Ng√†y k·∫øt th√∫c tu·∫ßn (LocalDate)
          - Khi click "Tu·∫ßn tr∆∞·ªõc": redirect v·ªõi query param ?weekOffset=-1
          - Khi click "Tu·∫ßn sau": redirect v·ªõi query param ?weekOffset=1
        -->
            <div class="week-navigation">
              <button class="week-nav-btn" onclick="navigateWeek(-1)">
                ‚óÄ Tu·∫ßn tr∆∞·ªõc
              </button>

              <div style="text-align: center">
                <div class="week-range">
                  <span th:text="${#temporals.format(weekStartDate, 'dd/MM/yyyy')}">5/10/2025</span>
                  -
                  <span th:text="${#temporals.format(weekEndDate, 'dd/MM/yyyy')}">11/10/2025</span>
                </div>
                <div class="week-current">Tu·∫ßn hi·ªán t·∫°i</div>
              </div>

              <button class="week-nav-btn" onclick="navigateWeek(1)">
                Tu·∫ßn sau ‚ñ∂
              </button>
            </div>

            <!-- Calendar Grid -->
            <!-- 
          BACKEND TODO #4: Chu·∫©n b·ªã d·ªØ li·ªáu calendar
          - T·∫°o Map<LocalDate, List<StaffShiftDTO>> shiftsByDay
          - StaffShiftDTO bao g·ªìm: id, workDate, shift (t√™n ca, gi·ªù), staff (t√™n NV), 
            status, checkIn, checkOut, hourlyWage, totalHours
          - Group c√°c shift theo ng√†y trong tu·∫ßn
          
          Model attribute: @ModelAttribute("weekDays") List<WeekDayDTO> weekDays
          
          WeekDayDTO {
            LocalDate date;
            String dayName; // CN, T2, T3, T4, T5, T6, T7
            boolean isToday;
            List<StaffShiftDTO> shifts;
          }
        -->
            <div class="calendar-grid">
              <!-- Loop qua 7 ng√†y trong tu·∫ßn -->
              <div class="day-column" th:each="day : ${weekDays}" th:classappend="${day.isToday} ? 'today' : ''">
                <div class="day-header">
                  <div class="day-name" th:text="${day.dayName}">CN</div>
                  <div class="day-number" th:text="${#temporals.format(day.date, 'dd')}">5</div>
                </div>

                <div class="shift-cards">
                  <!-- Loop qua c√°c ca trong ng√†y -->
                  <!-- BACKEND: M·ªói shift card c·∫ßn c√≥: CSS class theo lo·∫°i ca: morning/afternoon/evening, Staff name, Time range, Status: Ho√†n th√†nh/V·∫Øng m·∫∑t/ƒê√£ l√™n l·ªãch, Wage -->
                  <div class="shift-card" th:each="shift : ${day.shifts}" th:classappend="${shift.shiftType}" th:onclick="'editShift(' + ${shift.id} + ')'">
                    <div class="shift-type">
                      <span class="icon">‚úèÔ∏è</span>
                      <span th:text="${shift.shiftName}">S√°ng</span>
                    </div>

                    <div class="shift-staff" th:text="${shift.staffName}">
                      Ph·∫°m Th·ªã Dung
                    </div>

                    <div class="shift-time" th:text="${shift.timeRange}">
                      06:00 - 14:00
                    </div>

                    <!-- BACKEND: Status mapping - "Ho√†n th√†nh" -> class="completed", "V·∫Øng m·∫∑t" -> class="absent", "ƒê√£ l√™n l·ªãch" -> class="scheduled" -->
                    <div class="shift-status" th:classappend="${shift.statusClass}" th:text="${shift.statusText}">Ho√†n th√†nh</div>

                    <div class="shift-wage" th:text="${#numbers.formatDecimal(shift.totalWage, 0, 'POINT', 3, 'COMMA') + 'ƒë'}">280.000ƒë</div>
                  </div>
                </div>
              </div>
             </div>
           </div>
         </div>
           </div>
           <!-- End Tab: Calendar View -->

           <!-- Tab: Shift Types Management -->
           <div id="tab-shifts" class="tab-content">
             <div class="shift-management-card">
               <div class="shift-header">
                 <h2>Qu·∫£n l√Ω lo·∫°i ca l√†m vi·ªác</h2>
                 <a th:href="@{/manager/shift/create}" class="add-btn">+ Th√™m lo·∫°i ca m·ªõi</a>
               </div>

               <table class="shift-table">
                 <thead>
                   <tr>
                     <th>ID</th>
                     <th>T√™n ca l√†m vi·ªác</th>
                     <th>Gi·ªù b·∫Øt ƒë·∫ßu</th>
                     <th>Gi·ªù k·∫øt th√∫c</th>
                     <th>H√†nh ƒë·ªông</th>
                   </tr>
                 </thead>
                 <tbody>
                   <tr th:each="shift : ${shifts}">
                     <td th:text="${shift.id}">1</td>
                     <td th:text="${shift.shiftName}">Ca s√°ng</td>
                     <td th:text="${shift.startTime}">08:00</td>
                     <td th:text="${shift.endTime}">12:00</td>
                     <td class="actions">
                       <a class="primary-btn" th:href="@{'/manager/shift/edit/' + ${shift.id}}">S·ª≠a</a>
                       <a class="delete-btn" th:href="@{'/manager/shift/delete/' + ${shift.id}}" th:onclick="|return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ca #${shift.id}?');|">X√≥a</a>
                     </td>
                   </tr>
                 </tbody>
               </table>
             </div>
           </div>
           <!-- End Tab: Shift Types Management -->
         </div>
       </main>
     </div>

     <script th:src="@{/js/admin/shift-calendar.js}"></script>
   </body>
 </html>
