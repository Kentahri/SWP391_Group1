<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Manage Tables</title>
	<style>
		:root { --bg: #f6f7fb; --card: #ffffff; --muted: #6b7280; --text: #0f172a; --accent: #2563eb; --accent2: #a78bfa; --border: #e5e7eb; }
		* { box-sizing: border-box; }
		html, body { height: 100%; }
		body {
			margin: 0;
			font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
			background: var(--bg);
			color: var(--text);
		}
		.container {
			max-width: 900px;
			margin: 40px auto;
			padding: 24px;
		}
		.header {
			display: flex;
			align-items: center;
			gap: 12px;
			margin-bottom: 20px;
			justify-content: space-between;
		}
		.badge {
			background: linear-gradient(135deg, rgba(34,211,238,0.2), rgba(167,139,250,0.2));
			color: var(--text);
			padding: 6px 10px;
			border-radius: 999px;
			font-size: 12px;
			border: 1px solid rgba(255,255,255,0.1);
		}
		h2 { margin: 0; font-weight: 700; letter-spacing: 0.2px; }
		.subtitle { color: var(--muted); margin-top: 6px; }
		.grid { display: grid; grid-template-columns: 1fr; gap: 18px; }
		@media (min-width: 820px) { .grid { grid-template-columns: 1.1fr 1fr; } }

		.card {
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 16px;
			padding: 18px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.06);
		}
		.card h3 { margin: 0 0 12px 0; font-size: 18px; }

		.form-row { display: grid; gap: 10px; }
		label { font-size: 13px; color: var(--muted); }
		select {
			width: 100%;
			background: #ffffff;
			color: #111827;
			border: 1px solid var(--border);
			border-radius: 10px;
			padding: 10px 12px;
			outline: none;
		}
		button[type="submit"], .primary-btn {
			margin-top: 8px;
			padding: 10px 14px;
			border-radius: 10px;
			border: 1px solid transparent;
			background: var(--accent);
			color: #fff;
			font-weight: 700;
			cursor: pointer;
		}
		button[type="submit"]:hover, .primary-btn:hover { filter: brightness(1.05); }

		.list { display: grid; gap: 12px; }
		.list-item {
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 12px;
			background: #0b1220;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		/* Table map grid and tiles */
		.map-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
		@media (min-width: 560px) { .map-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
		@media (min-width: 920px) { .map-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
		.tile {
			border: 1px solid var(--border);
			border-radius: 12px;
			padding: 14px;
			background: #d1d5db;
			min-height: 86px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
		}
		.tile h4 { margin: 0; font-size: 14px; font-weight: 700; font-style: italic; }
		.status-dot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; position: absolute; top: 8px; right: 8px; }
		.tile.selected { box-shadow: 0 0 0 2px #111 inset; }
		/* Status visuals */
		.status-empty .status-dot { background: #34d399; }
		.status-occupied .status-dot { background: #ef4444; }
		.status-paying .status-dot { background: #f59e0b; }
		.status-reserved .status-dot { background: #a78bfa; }

		/* Light panel inside left card */
		.inner-panel { background: #ecebeb; border: 1px solid var(--border); border-radius: 16px; padding: 16px; }
		.pill { display: inline-flex; align-items: center; gap: 8px; background: #ffffff; border: 1px solid var(--border); color: #111827; padding: 6px 10px; border-radius: 999px; font-weight: 600; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
  

		/* Modal */
		.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: none; align-items: center; justify-content: center; padding: 16px; }
		.modal { background: #fff; border: 1px solid var(--border); border-radius: 14px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
		.modal header { padding: 14px 16px; border-bottom: 1px solid var(--border); font-weight: 700; }
		.modal .content { padding: 16px; }
		.modal .actions { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
		.btn-secondary { background: #e5e7eb; color: #111827; border-radius: 10px; padding: 10px 14px; border: 1px solid #d1d5db; cursor: pointer; }
	</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display:flex; align-items:center; gap:12px">
                <span class="badge">PizzarIO</span>
            </div>
			<button id="openAddTable" class="primary-btn" type="button">Th√™m m·ªõi 1 b√†n</button>
        </div>

        <div class="grid">
            <div class="card">
                <div class="pill">ü™ë Table map</div>
                <div class="inner-panel" style="margin-top:12px">
                    <div class="map-grid">
                        <div th:each="table: ${tables}" class="tile" style="border: 1px solid black"
                             th:attr="
                               data-id=${table.id},
                               data-type=${table.tableType.name()},
                               data-created-at=${#temporals.format(table.createdAt,'yyyy-MM-dd HH:mm')},
                               data-updated-at=${#temporals.format(table.updatedAt,'yyyy-MM-dd HH:mm')},
                               data-condition=${table.tableCondition != null ? table.tableCondition.name() : 'UNKNOWN'}"
                        >
                            <span class="status-dot"></span>
                            <h4>B√†n <span th:text="${table.id}"></span></h4>
                        </div>
					</div>

	<!-- Modal: Add Table -->
	<div id="addTableModal" class="modal-overlay" aria-hidden="true">
		<div class="modal" role="dialog" aria-modal="true">
			<header>Th√™m b√†n m·ªõi</header>
			<div class="content">
				<form id="addTableForm" th:action="@{/table/add}" method="post" th:object="${tableDTO}">
					<div class="form-row">
						<label>Table Type</label>
                        <label>
	                        <select id="newTableType" name="tableType" th:field="*{tableType}" required>
		                        <option th:each="type : ${tableTypes}" th:value="${type}" th:text="${type}"></option>
	                        </select>
                        </label>
                    </div>
					<div class="actions">
						<button type="button" class="btn-secondary" id="cancelAddTable">H·ªßy</button>
						<button type="submit" class="primary-btn">Th√™m</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Modal: Update Table -->
	<div id="updateTableModal" class="modal-overlay" aria-hidden="true">
		<div class="modal" role="dialog" aria-modal="true">
			<header>C·∫≠p nh·∫≠t b√†n</header>
			<div class="content">
				<form id="updateTableForm" method="post">
					<div class="form-row">
						<label>Table Type</label>
                        <label>
	                        <select id="updateTableType" name="tableType" required>
		                        <option th:each="type : ${tableTypes}" th:value="${type}" th:text="${type}"></option>
	                        </select>
                        </label>
                    </div>
					<div class="form-row">
						<label>Table Condition</label>
                        <label>
	                        <select id="updateTableCondition" name="tableCondition" required>
		                        <option th:each="condition : ${tableConditions}" th:value="${condition}" th:text="${condition}"></option>
	                        </select>
                        </label>
                    </div>
					<div class="actions">
						<button type="button" class="btn-secondary" id="cancelUpdateTable">H·ªßy</button>
						<button type="submit" class="primary-btn">C·∫≠p nh·∫≠t</button>
					</div>
				</form>
			</div>
		</div>
	</div>

    <script th:inline="javascript">
		(function(){
			// Add Table Modal
			var openBtn = document.getElementById('openAddTable');
			var modal = document.getElementById('addTableModal');
			var cancelBtn = document.getElementById('cancelAddTable');
			if(openBtn){ openBtn.addEventListener('click', function(){ modal.style.display = 'flex'; }); }
			if(cancelBtn){ cancelBtn.addEventListener('click', function(){ modal.style.display = 'none'; }); }
			modal && modal.addEventListener('click', function(e){ if(e.target === modal){ modal.style.display = 'none'; } });

			// Update Table Modal
			var updateModal = document.getElementById('updateTableModal');
			var cancelUpdateBtn = document.getElementById('cancelUpdateTable');
			if(cancelUpdateBtn){ cancelUpdateBtn.addEventListener('click', function(){ updateModal.style.display = 'none'; }); }
			updateModal && updateModal.addEventListener('click', function(e){ if(e.target === updateModal){ updateModal.style.display = 'none'; } });
		})();

        document.addEventListener('DOMContentLoaded', function () {
            const tiles = document.querySelectorAll('.tile');
            const deleteForm = document.getElementById('deleteForm');
            const updateForm = document.getElementById('updateTableForm');
            const tableActions = document.getElementById('tableActions');
            const deleteBase = /*[[@{/table/delete/}]]*/ ""; // context-safe base URL for delete
            const updateBase = /*[[@{/table/update/}]]*/ ""; // context-safe base URL for update
            
            let currentTableId = null;
            
            tiles.forEach(tile => {
                tile.addEventListener('click', function () {
                    tiles.forEach(t => t.classList.remove('selected'));
                    this.classList.add('selected');

                    const ds = this.dataset; // {type, createdAt, updatedAt, condition}
                    document.getElementById('detailType').textContent       = ds.type || '';
                    document.getElementById('detailCreatedAt').textContent  = ds.createdAt || '';
                    document.getElementById('detailUpdatedAt').textContent  = ds.updatedAt || '';
                    document.getElementById('detailCondition').textContent  = ds.condition || '';
                    document.getElementById('tableName').textContent   = 'B√†n ' + (ds.id || '');
                    
                    // Set current table ID for update
                    currentTableId = ds.id;
                    
                    // Set form actions
                    deleteForm.action = deleteBase + ds.id;
                    updateForm.action = updateBase + ds.id;
                    
                    // Pre-fill update form with current values
                    document.getElementById('updateTableType').value = ds.type || '';
                    document.getElementById('updateTableCondition').value = ds.condition || '';
                    
                    tableActions.style.display = 'flex';
                });
                tableActions.style.display = 'none';
            });
            
            // Delete form handler
            if (deleteForm) {
                deleteForm.addEventListener('submit', function (e) {
                    if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†n n√†y?')) {
                        e.preventDefault();
                    }
                });
            }
            
            // Update button handler
            const updateBtn = document.getElementById('updateTableBtn');
            if (updateBtn) {
                updateBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (currentTableId) {
                        document.getElementById('updateTableModal').style.display = 'flex';
                    }
                });
            }
        });
		
        
	</script>
                </div>
            </div>

            <div class="card">
                <div style="height:100%; display:flex; flex-direction:column; gap:12px">
                    <div style="font-weight:700" ><span id="tableName"></span></div>
	                <div>Type: <span id="detailType"></span></div>
	                <div>Created at: <span id="detailCreatedAt"></span></div>
	                <div>Updated at: <span id="detailUpdatedAt"></span></div>
	                <div>Condition: <span id="detailCondition"></span></div>
	                
	                
	                <div style="margin-top:auto; display:flex; justify-content:space-between" id="tableActions">
		                <form id="deleteForm" method="post">
			                <button class="primary-btn" style="background:#ef4444">Delete</button>
		                </form>
		                <form>
			                <button id="updateTableBtn" class="primary-btn">Update</button>
		                </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>